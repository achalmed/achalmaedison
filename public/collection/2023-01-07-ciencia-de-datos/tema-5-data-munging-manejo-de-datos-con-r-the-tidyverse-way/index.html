<!DOCTYPE html>
<html lang="es" dir="ltr"><head>
  
                           
     


<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.104.3" />
<title>Tema 5: Data munging: manejo de datos con R, the tidyverse way | Edison Achalma, Econ</title>


<meta property="twitter:site" content="@achalmaedison">
<meta property="twitter:creator" content="@achalmaedison">







  
    
  
<meta name="description" content="Personal website and portfolio of Dr. Edison Achalma.">


<meta property="og:site_name" content="Edison Achalma, Econ">
<meta property="og:title" content="Tema 5: Data munging: manejo de datos con R, the tidyverse way | Edison Achalma, Econ">
<meta property="og:description" content="Personal website and portfolio of Dr. Edison Achalma." />
<meta property="og:type" content="page" />
<meta property="og:url" content="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-5-data-munging-manejo-de-datos-con-r-the-tidyverse-way/" />
<meta property="og:locale" content="es">




    
        <meta property="og:image" content="https://achalmaedison.netlify.app/img/papillons.jpg" >
        <meta property="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="https://achalmaedison.netlify.app/img/papillons.jpg" >
    
  <meta itemprop="name" content="Tema 5: Data munging: manejo de datos con R, the tidyverse way">
<meta itemprop="description" content="1. Introducción En el tutorial anterior aprendimos a cargar datos en R. Sin embargo, es difícil que en una aplicación real tengamos los datos tal y como los necesitamos para hacer nuestro análisis. Habitualmente tendremos que trabajar los datos para arreglarlos. Este proceso, que en castellano podría llamarse “limpieza” o procesado de datos, se conoce en inglés como data munging or data wrangling.
En el curso vamos a trabajar/manejar los datos usando un conjunto de paquetes asociados asociados con el enfoque conocido como tidyverse."><meta itemprop="datePublished" content="2023-01-07T00:00:00+00:00" />
<meta itemprop="dateModified" content="2023-01-07T00:00:00+00:00" />
<meta itemprop="wordCount" content="11699">
<meta itemprop="keywords" content="" />
  
  
  <!--[if IE]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
  
  
  <link rel="stylesheet" href="/style.main.min.508aa34bb4fa7ebfddd6892a4ec251e1ce46ad0e0c5be6380abc84336f01b14e.css" integrity="sha256-UIqjS7T6fr/d1okqTsJR4c5GrQ4MW&#43;Y4CryEM28BsU4=" media="screen">
  
  
  <script src="/panelset.min.ed1ac24b6e16f4e2481e3d1d098ae66f5bc77438aef619e6e266d8ac5b00dc72.js" type="text/javascript"></script>
  
  
  <script src="/main.min.02a29b97ea7a4341cfaeac25ec5d87e828bb26670131a26f6257f4e0a8dd2e6e.js" type="text/javascript"></script>
</head>
<body>
      <div class="grid-container single-series">
<header class="site-header pt4 pb2 mb4 bb b--transparent ph5 headroom z-max" role="banner">
  <nav class="site-nav db dt-l w-100" role="navigation">
    <a class="site-brand db dtc-l v-mid link no-underline w-100 w-33-l tc tl-l" href="https://achalmaedison.netlify.app/" title="Home">
      <img src="/img/penguin.png" class="dib db-l h2 w-auto" alt="Edison Achalma, Econ">
    </a>
    <div class="site-links db dtc-l v-mid w-100 w-47-l tc tr-l mt3 mt0-l ttu tracked">
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/about/" title="About Blogophonic">Sobre Mí</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/blog/" title="Blog">Blog</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/project/" title="Project Portfolio">Proyectos</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/talk/" title="Talks">Talks</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 active" href="/collection/" title="A collection">Cursos</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/elements/" title="Element Page">Elementos</a>
      
      
    </div>
  </nav>
</header>


<main class="page-main ph4 pt4" role="main">
  <section class="page-content mw7 center">
    <article class="post-content pa0 pr3-l">
      <header class="post-header">
        <h4 class="breadcrumb pb5">

  
    
      
  
    
      
  
    
      
  

    
    
      <a href="/collection/">Cursos</a>
    
  

    
    
      <a href="/collection/2023-01-07-ciencia-de-datos/">Ciencia de datos</a>
    
  

    
    
      Tema 5: Data munging: manejo de datos con R, the tidyverse way
    
  

</h4>




        
        <h1 class="f1 lh-solid measure-narrow mb3 fw4">Tema 5: Data munging: manejo de datos con R, the tidyverse way</h1>
        
        <p class="f6 measure lh-copy mv1">By Edison Achalma Mendoza</p>
        <p class="f7 db mv0 ttu">January 7, 2023</p>
        
        
      
        
      </header>
      <section class="post-body pt5 pb4">
        <script src="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-5-data-munging-manejo-de-datos-con-r-the-tidyverse-way/index_files/clipboard/clipboard.min.js"></script>
<link href="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-5-data-munging-manejo-de-datos-con-r-the-tidyverse-way/index_files/primer-tooltips/build.css" rel="stylesheet" />
<link href="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-5-data-munging-manejo-de-datos-con-r-the-tidyverse-way/index_files/klippy/css/klippy.min.css" rel="stylesheet" />
<script src="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-5-data-munging-manejo-de-datos-con-r-the-tidyverse-way/index_files/klippy/js/klippy.min.js"></script>
<script src="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-5-data-munging-manejo-de-datos-con-r-the-tidyverse-way/index_files/twitter-widget/widgets.js"></script>
<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<hr>
<br>




<h1 id="1-introducción">1. Introducción
  <a href="#1-introducci%c3%b3n"></a>
</h1>
<br>
<p>En el tutorial anterior aprendimos a cargar datos en R. Sin embargo, es difícil que en una aplicación real tengamos los datos tal y como los necesitamos para hacer nuestro análisis. Habitualmente tendremos que trabajar los datos para arreglarlos. Este proceso, que en castellano podría llamarse “limpieza” o <strong>procesado de datos</strong>, se conoce en inglés como <strong>data munging or data wrangling</strong>.</p>
<p>En el curso vamos a trabajar/manejar los datos usando un conjunto de paquetes asociados asociados con el enfoque conocido como <strong>tidyverse</strong>. Como puedes ver en la imagen, ya hemos importado los datos y, antes de empezar a hacer el verdadero análisis, tenemos que pasar por 2 etapas más:</p>
<ul>
<li>hacer nuestros datos tidy</li>
<li>arreglarlos para que sean útiles para nuestros propósitos</li>
</ul>
<br>
<br>
<p>Se suele decir que el procesado/limpieza de los datos suele ocupar un 80% del tiempo de un análisis de datos. Quizás sea una cifra un poco exagerada, pero, en cualquier caso, es una tarea que ocupa tiempo y que puede llegar a ser tediosa y frustrante si no se dispone de las <strong>herramientas adecuadas</strong>. Incluso datos que parecen que ya están trabajados es bastante fácil que tengamos que trabajarlos para adaptarlos a nuestras necesidades.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>Una secuencia <span style="color:#d14">&#34;real&#34;</span> de tweets<span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#099">0930</span><span style="color:#000;font-weight:bold">:</span> How lucky I am to work on clean datasets curated by true professionals.
</span></span><span style="display:flex;"><span><span style="color:#099">1330</span><span style="color:#000;font-weight:bold">:</span> Huh. Some inconsistencies here. No bigs. Ill just write up some quick and dirty regex to clean this up.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#099">1720</span><span style="color:#000;font-weight:bold">:</span> I WILL BURN THIS HERETICAL DATA CENTER AND SCATTER ITS <span style="color:#900;font-weight:bold">ASHES </span>(traducción<span style="color:#000;font-weight:bold">:</span> me cago en todo lo que se menea)
</span></span></code></pre></div><p>En clase utilizamos datos reales, pero la verdad es que suelen ya estar casi limpios del todo. Estamos aprendiendo.</p>
<blockquote>
<p>Classroom data are like teddy bears; real data are like a grizzly with salmon blood dripping out its mouth. —- [@JennyBryan]</p>
</blockquote>
<p>Como dice Albert Y. Kim en 
<a href="http://rpubs.com/rudeboybert/eCOTS_2018" target="_blank" rel="noopener">estas transparencias</a> los datos utilizados para aprender a manejar datos tienen que ser realistas pero sin llegar a ser intimidantes.</p>
<br>
<p>En este tutorial aprenderemos a limpiar y transformar datos en R. Priorizaremos la nueva forma de hacer las cosas en R (o workflow) conocido como <strong>tidyverse</strong>. En los últimos años se ha convertido, por varias razones, en el enfoque estándar; a pesar de ello, cada cierto tiempo vuelve a reabrirse el debate sobre cómo enseñar/aprender R y si es apropiado priorizar el tidyverse sobre R-base. 
<a href="https://twitter.com/kaija_bean/status/1217293396706054145" target="_blank" rel="noopener">Aquí</a> tienes un hilo de twitter donde se debate sobre este tema.</p>
<br>
<p>
<a href="http://www.onthelambda.com/2014/02/10/how-dplyr-replaced-my-most-common-r-idioms/" target="_blank" rel="noopener">Aquí</a> tenéis un post sobre las diferencias entre las funciones de R-base y las del tidyverse para el procesado de datos, y 
<a href="http://zevross.com/blog/2015/01/13/a-new-data-processing-workflow-for-r-dplyr-magrittr-tidyr-ggplot2/" target="_blank" rel="noopener">aquí</a> otro post de un nuevo convencido de las bondades de esta nueva forma de manipular datos en R. Como ejemplo:</p>
<blockquote>
<p>Up until last year my R workflow was not dramatically different from when I started using R more than 10 years ago. Thanks to several R package authors, most notably Hadley Wickham, my workflow has changed for the better using dplyr, magrittr, tidyr and ggplot2. Given how much I’ve enjoyed the speed and clarity of the new workflow</p>
</blockquote>
<br>
<hr>




<h2 id="tidyverse">Tidyverse
  <a href="#tidyverse"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>




<h4 id="qué-es-esto-del-tidyverse">¿Qué es esto del tidyverse?
  <a href="#qu%c3%a9-es-esto-del-tidyverse"></a>
</h4>
<br>
<p>Con la palabra tidyverse se hace referencia a una “nueva” forma de afrontar el análisis de datos en R en la que se hace uso de <strong>un grupo de paquetes que trabajan en armonía</strong> porque comparten ciertos principios, como por ejemplo, la forma de estructurar los datos.</p>
<p>La mayoría de estos paquetes han sido desarrollados por (o al menos con la colaboración de) 
<a href="http://hadley.nz/" target="_blank" rel="noopener">Hadley Wickham</a>. Esta es la 
<a href="https://www.tidyverse.org/" target="_blank" rel="noopener">página web del tidyverse</a></p>
<p>No es necesario, pero si quieres conocer un poco mejor qué es el tidyverse, puedes hacerlo leyendo 
<a href="https://cran.r-project.org/web/packages/tidyverse/vignettes/manifesto.html" target="_blank" rel="noopener">The tidy tools manifesto</a>. Está cita es un buen referente de la filosofía o enfoque del tidyverse</p>
<blockquote>
<p>Programs must be written for people to read, and only incidentally for machines to execute – Hal Abelson</p>
</blockquote>
<br>
<p>Para continuar entendiendo qué es esto del tidyverse, citaré 2 de sus principios:</p>
<ul>
<li>
<p>Los scripts deben ser <strong>“fácilmente” legibles por las personas</strong></p>
</li>
<li>
<p><strong>Resolver problemas complejos</strong> encadenando funciones simples con el <strong>operador <code>%&gt;%</code></strong></p>
</li>
</ul>
<br>
<hr>




<h2 id="the-pipe-">The pipe (<code>%&gt;%</code>)
  <a href="#the-pipe-"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Este operador ocupa un lugar fundamental en el tidyverse. Permite resolver un problema complejo no de una sola vez, sino encadenando llamadas a funciones que se van encadenando con el operador <code>%&gt;%</code>. Este operador facilita mucho la lectura e interpretación del código, ya que se van encadenando operaciones sencillas para, poco a poco, conseguir transformaciones de datos complejas. El <strong>operador pipe</strong> se lo debemos a Stefan Bache en su pkg 
<a href="https://github.com/tidyverse/magrittr" target="_blank" rel="noopener">magrittr</a>.</p>
<br>
<p>En palabras, lo que hace este operador es <strong>pasar el elemento que está a su izquierda como un argumento de la función que tiene a la derecha</strong>. Así al principio parece complicado.</p>
<p><strong>Con expresiones</strong> el operador pipe hace:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">–</th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">f(object, argumentos de la función)</td>
<td style="text-align:center">ES EQUIVALENTE a</td>
<td style="text-align:center">object %&gt;% f(argumentos de la función)</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">–</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<br>
<p><strong>Se entiende mejor con ejemplos sencillos</strong>. Las siguientes dos instrucciones de R <strong>hacen exactamente lo mismo</strong>: permiten ver las 4 primeras filas del <code>penguins</code> dataset.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(palmerpenguins)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">head</span>(penguins, n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>)         <span style="color:#998;font-style:italic">#- forma habitual de llamar/usar la función head()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>penguins <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">head</span>(. , n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>)  <span style="color:#998;font-style:italic">#- usando el operador pipe</span>
</span></span></code></pre></div><p>La primera expresión es la manera habitual de usar/llamar a la función <code>head()</code>. La segunda expresión es la sintaxis, la forma que hay que usar, si trabajamos con el operador pipe.</p>
<p>Así, a primera vista, parece que el operador <code>%&gt;%</code> no supone ninguna ventaja, sólo es una forma distinta de ejecutar o llamar a una función, y a primera vista parece complicar las cosas. Sí, eso es cierto, si solo usas una función no tendría mucho sentido usar <code>%&gt;%</code>, pero cuando tienes que hacer una sucesión de cálculos, una sucesión de llamadas a funciones, facilita mucho la lectura del código y por tanto el análisis. Lo vemos enseguida.</p>
<p>Para entender un poco más el funcionamiento de <code>%&gt;%</code>, has de ver que estas tres instrucciones son equivalentes.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">head</span>(penguins, n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>)         <span style="color:#998;font-style:italic">#- forma habitual de llamar/usar la función head()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>penguins <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">head</span>(. , n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>)  <span style="color:#998;font-style:italic">#- usando el operador pipe (con el punto actuando como placeholder)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>penguins <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">head</span>(n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>)      <span style="color:#998;font-style:italic">#- usando el operador pipe (SIN el punto)</span>
</span></span></code></pre></div><p>El punto de la segunda expresión señala, le dice a the pipe donde debe situarse el argumento de la izquierda dentro de la función; en nuestro ejemplo le dice a <code>%&gt;%</code> que <code>penguins</code> debe situarse en el primer slot de <code>head()</code>. El punto <code>.</code> le está diciendo a <code>%&gt;%</code> donde debe situarse <code>penguins</code>; es decir, el punto actúa, lo estamos usando, como un “placeholder”.</p>
<p>La tercera expresión también funciona porque si no usamos el punto (<code>.</code>), entonces, por defecto, el operador pipe situará <code>penguins</code> en el primer slot de la función, en nuestro caso situará a <code>penguins</code> en el primer slot de <code>head()</code>.</p>
<p>La forma más habitual es no poner el <code>.</code>; es decir, la tercera expresión. La razón es simplemente que se ahorra tiempo al escribir, aunque la segunda expresión es mucho más explicita, más descriptiva, de lo que hace el operador pipe.</p>
<br>
<p>Para casi terminar de entender la sintaxis del operador pipe. Intentad ver si entendéis la siguiente instrucción:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#099">4</span> <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">head</span>(penguins, .)
</span></span></code></pre></div><p>Si no sabéis lo que hace, siempre podéis ejecutar la instrucción en la consola de RStudio.</p>
<p>Recuerda: Cuando usamos el operador pipe, tenemos obligatoriamente que usar el punto si queremos que el argumento de la izquierda se sitúe en un slot diferente del primer slot</p>
<br>
<p>Para acabar nuestro repaso a <code>%&gt;%</code> mirad por qué no funciona la siguiente instrucción:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#099">4</span> <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">head</span>(penguins)
</span></span></code></pre></div><p>El operador pipe quiere llevar el <code>4</code> al primer slot de <code>head()</code> ya que si no ponemos el punto, ese es su comportamiento por defecto. Sin embargo, al ejecutar la expresión, el interprete de R nos devuelve un mensaje de error. ¿Por qué? Tendrás que mirar la ayuda de la función con <code>help(head)</code>.</p>
<br>
<p>Aún no sabemos muy bien cuál es su utilidad, pero ya conocemos la sintaxis de <code>%&gt;%</code>. Lo que hace que este operador sea tan útil es que <strong>las pipes se pueden encadenar</strong>.</p>
<br>
<p>El operador pipe podemos leerlo como <strong>“<em>entonces</em>”</strong> y permite encadenar sucesivas llamadas a funciones. Por ejemplo:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>penguins <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(sex <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;female&#34;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>             <span style="color:#900;font-weight:bold">group_by</span>(species) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>             <span style="color:#900;font-weight:bold">summarise</span>(peso_medio <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(body_mass_g))
</span></span></code></pre></div><br>
<p>La anterior linea de código R hace:</p>
<ol>
<li>coge los datos de pingüinos y selecciona (o filtra) las filas/pinguinos cuyo valor de la variable <code>sex</code> es female; es decir, seleccionamos los pingüinos hembras, <em>entonces</em> (o después)</li>
<li>agrupa los datos/pingüinos por la variable <code>species</code>, <em>entonces</em></li>
<li>calcula la media de <code>body_mass_g</code></li>
</ol>
<p>En conjunto, encadenando las 3 funciones hemos seleccionado las filas que pertenecen a pingüinos hembras, hemos agrupado las pingüino hembras en función de su especie (hay 3 especies de pingüinos) y calculado el peso medio de cada uno de las 3 especies de pingüinos; es decir, hemos calculado el peso medio de las pingüinos hembra en cada uno de las tres especies de pingüinos.</p>
<br>
<p>Con esta nueva sintaxis (que permite el operador pipe) ya no necesitamos anidar funciones, sino que las instrucciones van una después de otra. Es <strong>mucho más fácil de leer y de escribir</strong>. Esta idea de que es mucho más fácil escribir à la tidyverse no se llega a apreciar con los ejemplos que hemos hecho en esta sección, pero se hará evidente cuando empecemos a encadenar operaciones con dplyr. Como ejemplo este tweet.</p>
<blockquote class="twitter-tweet" align="center" data-width="550" data-lang="en" data-dnt="true" data-theme="light"><p lang="es" dir="ltr">Si vas a pasar el tiempo tratando de humillarme, haciendo que la clase sea innecesariamente dura, entonces mejor me voy, pero si de verdad quieres hacer el esfuerzo de ser un buen maestro entonces yo también estoy dispuesto a intentarlo.</p>&mdash; Edison Achalma (@achalmaedison) <a href="https://twitter.com/achalmaedison/status/1597228787431002113?ref_src=twsrc%5Etfw">November 28, 2022</a></blockquote>
<br>
<p>No te va a resultar sencillo porque no sabes que es <code>letters</code>, ni <code>paste0()</code>, ni <code>toupper()</code>, pero intenta entender por ti mismo que hace la siguiente linea de código. ya sabes que siempre puedes ejecutarla y ver que hace, y mucho mejor si la ejecutas por trozos para ir viendo poco a poco qué hace:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">letters</span> <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">paste0</span>( <span style="color:#d14">&#34;-----&#34;</span> ,  .  ,  <span style="color:#d14">&#34;!!!&#34;</span> ) <span style="color:#000;font-weight:bold">%&gt;%</span> toupper
</span></span></code></pre></div><br>




<h4 id="un-poco-más-acerca-de-the-pipe--opcional">Un poco más acerca de the pipe (<code>%&gt;%</code>) [OPCIONAL]
  <a href="#un-poco-m%c3%a1s-acerca-de-the-pipe--opcional"></a>
</h4>
<p>De forma más técnica. Aquí podéis ver el funcionamiento del operador pipe:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(<span style="color:#d14">&#34;magrittr&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#-------- Rule 1</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">f</span>(xx)     es equivalente a     xx <span style="color:#000;font-weight:bold">%&gt;%</span> f
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#-------- Rule 2</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">g</span>(xx, n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">5</span>)
</span></span><span style="display:flex;"><span>xx <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">g</span>(n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#-------- Rule 3</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">g</span>(<span style="color:#900;font-weight:bold">f</span>(xx), n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">5</span>)
</span></span><span style="display:flex;"><span>xx <span style="color:#000;font-weight:bold">%&gt;%</span> f <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">g</span>(n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Se lee como <span style="color:#d14">&#34;Take xx then do f then do g with n = 5&#34;</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#-------- Rule 4</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">f</span>(y, x)
</span></span><span style="display:flex;"><span>x <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">f</span>(y, .)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#-------- Rule 5</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">f</span>(y, z <span style="color:#000;font-weight:bold">=</span> x)
</span></span><span style="display:flex;"><span>x <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">f</span>(y, z <span style="color:#000;font-weight:bold">=</span> .)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#(!!!!)------------- BONUS: The input to the pipeline can itself be a placeholder!!</span>
</span></span><span style="display:flex;"><span>num_unique <span style="color:#000;font-weight:bold">&lt;-</span> . <span style="color:#000;font-weight:bold">%&gt;%</span> unique <span style="color:#000;font-weight:bold">%&gt;%</span> length       
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">num_unique</span>(iris<span style="color:#000;font-weight:bold">$</span>Species)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>iris<span style="color:#000;font-weight:bold">$</span>Species <span style="color:#000;font-weight:bold">%&gt;%</span> num_unique
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">-----</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>num_unique es equivalente a <span style="color:#000;font-weight:bold">:</span> f <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">function</span>(.) <span style="color:#900;font-weight:bold">length</span>(<span style="color:#900;font-weight:bold">unique</span>(.)) 
</span></span></code></pre></div><br>
<p>Un buen recurso para aprender el uso de <code>%&gt;%</code> son 
<a href="https://teachthat.netlify.app/pipe/#1" target="_blank" rel="noopener">estas transparencias</a>. Una exposición más detallada de la sintaxis y posibilidades del operador <code>%&gt;%</code>, así como la de otros operadores como <code>%T&gt;%</code> y <code>%&lt;&gt;%</code> puedes encontrarla 
<a href="https://www.rdocumentation.org/packages/magrittr/versions/1.5" target="_blank" rel="noopener">aquí</a>.</p>
<br>
<p>The <strong>“tee pipe”</strong> (<code>%T&gt;%</code>) permite hacer cosas como esta:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- !!!!!!</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">rnorm</span>(<span style="color:#099">200</span>) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">matrix</span>(ncol <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>) <span style="color:#000;font-weight:bold">%T&gt;%</span>
</span></span><span style="display:flex;"><span>plot <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#998;font-style:italic"># plot usually does not return anything. </span>
</span></span><span style="display:flex;"><span>colSums
</span></span></code></pre></div><p>The <strong>“tee pipe”</strong>, como el pipe original, pasa el argumento de la izquierda a la función de la derecha, PERO devuelve el propio valor original, no devuelve el resultado de la evaluación de la función. Como se señala 
<a href="https://magrittr.tidyverse.org/reference/tee.html" target="_blank" rel="noopener">aquí</a>, este comportamiento es útil cuando se usa la función por sus side-effects; es decir, para imprimir o graficar. Yo la utilidad que le veo es hacer chequeos dentro de una secuencia de pipes, como por ejemplo hacen en 
<a href="https://twitter.com/lepovas/status/1283411774134538251" target="_blank" rel="noopener">este tweet</a></p>
<br>
The **“exposition pipe”** (`%$%`) también del pkg `magrittr`. En [este post](https://thewoodpeckr.wordpress.com/2020/02/10/upping-your-pipe-game/) nos explican su utilidad. Pero solo leedlo cuando ya seáis usuarios intermedios de R. Sirve para hacer accesibles las columnas de un dataframe a funciones que no admiten dataframes como la función `cor()`. De esta forma podemos integrar en nuestro pipeline funciones que no están preparadas para el tidyverse.
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- !!!</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(magrittr)
</span></span><span style="display:flex;"><span>iris <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mean</span>(Sepal.Length)   <span style="color:#998;font-style:italic">#- no funciona</span>
</span></span><span style="display:flex;"><span>iris <span style="color:#000;font-weight:bold">%$%</span> <span style="color:#900;font-weight:bold">mean</span>(Sepal.Length)   <span style="color:#998;font-style:italic">#- con the exposition pipe sí funciona</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>iris <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">cor</span>(Sepal.Length, Sepal.Width)  <span style="color:#998;font-style:italic">#- no funciona</span>
</span></span><span style="display:flex;"><span>iris <span style="color:#000;font-weight:bold">%$%</span> <span style="color:#900;font-weight:bold">cor</span>(Sepal.Length, Sepal.Width)
</span></span></code></pre></div><p>Si no usásemos este nueva pipe, tendríamos que hacer lo siguiente:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">cor</span>(iris<span style="color:#000;font-weight:bold">$</span>Sepal.Length, iris<span style="color:#000;font-weight:bold">$</span>Sepal.Width)
</span></span></code></pre></div><br>
<p>Muchas funciones de R-base no están preparadas para trabajar con el operador pipe. Son funciones que se escribieron antes de que se creara <code>%&gt;%</code>. Se puede tratar de reescribir código en “R-base” usando <code>%&gt;%</code> pero no tiene mucho sentido y no es muy agradable; sin embargo si se trabaja con el tidyverse, utilizar the pipe hace la sintaxis muy fluida. Como ejemplo de esto el siguiente chunk:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(tidyverse)    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x1 <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">-5</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">5</span>, <span style="color:#000;font-weight:bold">NA</span>)  <span style="color:#998;font-style:italic">#- es un vector</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- escribiendo à la R-base</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">mean</span>(x1[x1<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#099">0</span>], na.rm <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">TRUE</span>)   <span style="color:#998;font-style:italic">#-  calcula la media de los valores positivos de x1</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">sum</span>(x1[<span style="color:#000;font-weight:bold">!</span><span style="color:#900;font-weight:bold">is.na</span>(x1)])            <span style="color:#998;font-style:italic">#-  calcula la suma de los valores de x1 que no son NA</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- ahora haremos lo mismo, seguimos usando R-base, pero con el operador pipe (!!!!)</span>
</span></span><span style="display:flex;"><span>x1 <span style="color:#000;font-weight:bold">%&gt;%</span> .[.<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mean</span>(., na.rm <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">TRUE</span>)
</span></span><span style="display:flex;"><span>x1 <span style="color:#000;font-weight:bold">%&gt;%</span> .[<span style="color:#000;font-weight:bold">!</span><span style="color:#900;font-weight:bold">is.na</span>(.)]  <span style="color:#000;font-weight:bold">%&gt;%</span> sum
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- podríamos trabajar con data.frames usando the exposition pipe</span>
</span></span><span style="display:flex;"><span>df <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">as.data.frame</span>(x1)   <span style="color:#998;font-style:italic">#- tidyverse usa data.frames</span>
</span></span><span style="display:flex;"><span>df <span style="color:#000;font-weight:bold">%$%</span> x1 <span style="color:#000;font-weight:bold">%&gt;%</span> .[.<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mean</span>(., na.rm <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">TRUE</span>)
</span></span><span style="display:flex;"><span>df <span style="color:#000;font-weight:bold">%$%</span> x1 <span style="color:#000;font-weight:bold">%&gt;%</span> .[<span style="color:#000;font-weight:bold">!</span><span style="color:#900;font-weight:bold">is.na</span>(.)]  <span style="color:#000;font-weight:bold">%&gt;%</span> sum
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- con tydiverse</span>
</span></span><span style="display:flex;"><span>df <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">as.data.frame</span>(x1)   <span style="color:#998;font-style:italic">#- tidyverse usa data.frames</span>
</span></span><span style="display:flex;"><span>df <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(x1 <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">0</span>) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(mean_x1 <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(x1, na.rm <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">TRUE</span>))
</span></span><span style="display:flex;"><span>df <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(<span style="color:#000;font-weight:bold">!</span><span style="color:#900;font-weight:bold">is.na</span>(x1)) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(suma_x1 <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">sum</span>(x1))
</span></span></code></pre></div><br>
<p>Bien, ya sabemos como funciona “the pipe”. Volvamos al tidyverse y a aprender a manipular datos en R.</p>
<br>




<h2 id="principales-pkgs-del-tidyverse">Principales pkgs del tidyverse
  <a href="#principales-pkgs-del-tidyverse"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Como puede verse en su 
<a href="https://www.tidyverse.org/" target="_blank" rel="noopener">página web</a>, los principales packages del tidyverse son:</p>
<ul>
<li>
<p><code>readr</code>: para importar datos</p>
</li>
<li>
<p><code>tidyr</code>: para convertir los datos a tidy data</p>
</li>
<li>
<p><code>dplyr</code>: para manipular datos</p>
</li>
<li>
<p><code>ggplot2</code>: para hacer gráficos</p>
</li>
<li>
<p><code>tibble</code>: data frames actualizados</p>
</li>
<li>
<p><code>forcast</code>: para manipular factores</p>
</li>
<li>
<p><code>stringr</code>: para manipular strings</p>
</li>
<li>
<p><code>purrr</code>: para functional programming</p>
</li>
<li>
<p>y algunos más</p>
</li>
</ul>
<p>Nos centraremos en los <strong>cuatro primeros paquetes</strong>, principalmente en <code>dplyr</code> y <code>ggplot2</code>.</p>
<br>
<p>Los principales paquetes del tidyverse se han “agrupado” en un metapaquete llamado <code>tidyverse</code>, así que cuando ejecutas <code>library(tidyverse)</code> en realidad estás cargando varios paquetes del tidyverse</p>
<br>
<hr>




<h1 id="2-tidy-data-tidyr">2. Tidy data (tidyr)
  <a href="#2-tidy-data-tidyr"></a>
</h1>
<br>
<blockquote>
<p>If I had one thing to tell biologists learning bioinformatics, it would be write code for humans, <strong>write data for computers</strong>. —-— Vince Buffalo (@vsbuffalo)</p>
</blockquote>
<p>Y si vamos a manejar datos con R y a la manera del tidyverse, como Jenny Bryan señala en su excelente 
<a href="https://github.com/jennybc/lotr-tidy/blob/master/01-intro.md" target="_blank" rel="noopener">tutorial sobre tidy data</a>:</p>
<blockquote>
<p>An important aspect of “writing data for computers” is to <strong>make your data TIDY</strong>. —- Jenny Bryan</p>
</blockquote>
<br>
<p>Antes de comenzar a manipular los datos à la tidyverse, es conviene saber que se entiende por <strong>tidy data</strong>. La razón es que los paquetes del tidyverse trabajan mejor si los datos están en formato tidy. Es fácil!!</p>
<br>




<h4 id="qué-son-los-tidy-data">¿Qué son los <strong>tidy data</strong>?
  <a href="#qu%c3%a9-son-los-tidy-data"></a>
</h4>
<p>Ahora lo veremos, pero enfatizar que si los datos son tidy (si siguen ese formato) <strong>será más fácil trabajar con ellos con el tidyverse</strong>, ya sea para manipularlos o para hacer gráficos.</p>
<p>De forma sencilla, tidy data son simplemente datos organizados de una determinada manera. Además es justo de la manera a la estamos familiarizados. De forma más precisa se puede leer 
<a href="https://en.wikipedia.org/wiki/Tidy_data" target="_blank" rel="noopener">aquí</a>, o de forma más elaborada [
<a href="ftp://cran.r-project.org/pub/R/web/packages/tidyr/vignettes/tidy-data.html">aquí</a>] :</p>
<blockquote>
<p>Tidy datasets provide a standardized way to link the structure of a dataset (its physical layout) with its semantics (its meaning). —– Hadley Wickham</p>
</blockquote>
<br>
<p>La mayoría de datos en Ciencias Sociales se ajustan a la categoría de datos tabulares; es decir, <strong>están organizados en filas y columnas</strong>. En R este tipo de datos se almacenan en dataframes (o tibbles). En esencia, un dataframe será tidy si cada columna es una variable y cada fila es una unidad de análisis (persona, país, región etc…); es decir, cada celda contiene el valor de una variable para una unidad de análisis.</p>
<blockquote>
<p>A dataset is a collection of values. Every value belongs to a variable and an observation. A variable contains all values that measure the same underlying attribute (like height, temperature, duration) across units. An observation contains all values measured on the same unit (like a person, or a day, or a race) across attributes</p>
</blockquote>
<br>
<p>No parece muy alejado de lo que estamos acostumbrados. Pero …. desarrollemos la idea un poco más.</p>
<br>




<h4 id="un-ejemplo-de-datos-no-tidy">Un ejemplo de datos (no tidy)
  <a href="#un-ejemplo-de-datos-no-tidy"></a>
</h4>
<p>Supongamos que la variable (o atributo) a medir es el salario y la unidad de análisis las personas. Hemos recogido datos para 3 personas. Veámoslos:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>data_1 <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">data.frame</span>(
</span></span><span style="display:flex;"><span>            year  <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;2014&#34;</span>, <span style="color:#d14">&#34;2015&#34;</span>, <span style="color:#d14">&#34;2016&#34;</span>),  
</span></span><span style="display:flex;"><span>            Pedro <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">100</span>, <span style="color:#099">500</span>, <span style="color:#099">200</span>), 
</span></span><span style="display:flex;"><span>            Carla <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">400</span>, <span style="color:#099">600</span>, <span style="color:#099">250</span>), 
</span></span><span style="display:flex;"><span>            María <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">200</span>, <span style="color:#099">700</span>, <span style="color:#099">900</span>)  )
</span></span><span style="display:flex;"><span>data_1
</span></span></code></pre></div><table>
<thead>
<tr>
<th style="text-align:center">year</th>
<th style="text-align:center">Pedro</th>
<th style="text-align:center">Carla</th>
<th style="text-align:center">María</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">2014</td>
<td style="text-align:center">100</td>
<td style="text-align:center">400</td>
<td style="text-align:center">200</td>
</tr>
<tr>
<td style="text-align:center">2015</td>
<td style="text-align:center">500</td>
<td style="text-align:center">600</td>
<td style="text-align:center">700</td>
</tr>
<tr>
<td style="text-align:center">2016</td>
<td style="text-align:center">200</td>
<td style="text-align:center">250</td>
<td style="text-align:center">900</td>
</tr>
</tbody>
</table>
<p>Table 1: Tabla 1: Salario de 3 personas:</p>
<p>Entendemos perfectamente estos datos, visualmente son cómodos, pero ¿son tidy data? NO* porque los individuos (o unidades de análisis) están en columnas.</p>
<br>




<h4 id="un-ejemplo-de-datos-tidy-pero-wide">Un ejemplo de datos (tidy* pero wide)
  <a href="#un-ejemplo-de-datos-tidy-pero-wide"></a>
</h4>
<p>Exactamente los mismos datos podrían estructurarse así:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>data_2 <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">data.frame</span>(names <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;Pedro&#34;</span>, <span style="color:#d14">&#34;Carla&#34;</span>, <span style="color:#d14">&#34;María&#34;</span>), 
</span></span><span style="display:flex;"><span>                      W_2014 <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">100</span>, <span style="color:#099">400</span>, <span style="color:#099">200</span>), 
</span></span><span style="display:flex;"><span>                      W_2015 <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">500</span>, <span style="color:#099">600</span>, <span style="color:#099">700</span>),
</span></span><span style="display:flex;"><span>                      W_2016 <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">200</span>, <span style="color:#099">250</span>, <span style="color:#099">900</span>)   )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data_2
</span></span></code></pre></div><table>
<thead>
<tr>
<th style="text-align:center">names</th>
<th style="text-align:center">W_2014</th>
<th style="text-align:center">W_2015</th>
<th style="text-align:center">W_2016</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Pedro</td>
<td style="text-align:center">100</td>
<td style="text-align:center">500</td>
<td style="text-align:center">200</td>
</tr>
<tr>
<td style="text-align:center">Carla</td>
<td style="text-align:center">400</td>
<td style="text-align:center">600</td>
<td style="text-align:center">250</td>
</tr>
<tr>
<td style="text-align:center">María</td>
<td style="text-align:center">200</td>
<td style="text-align:center">700</td>
<td style="text-align:center">900</td>
</tr>
</tbody>
</table>
<p>Table 2: Tabla 2: Salario de 3 personas (wide format)</p>
<p>También es un formato fácil de entender por nosotros, pero ¿son tidy? SI*, pero …</p>
<ul>
<li>
<p>Es el formato al que estamos más acostumbrados (individuos o registros en filas y “variables” en columnas). ¿Realmente el W de 2014 es una variable?</p>
</li>
<li>
<p>En jerga del tidyverse este formato de datos es <strong>“wide”</strong> (o ancho)</p>
</li>
</ul>
<br>
<p>Podemos trabajar tranquilamente con el anterior formato, PERO, si queremos sacar todo el provecho al tidyverse es mejor tener los datos en <strong>long format</strong>.</p>
<br>




<h4 id="un-ejemplo-de-datos-tidy-tidy-y-long">Un ejemplo de datos (tidy-tidy y long)
  <a href="#un-ejemplo-de-datos-tidy-tidy-y-long"></a>
</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>data_3 <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">data.frame</span>(
</span></span><span style="display:flex;"><span>            names <span style="color:#000;font-weight:bold">=</span><span style="color:#900;font-weight:bold">rep</span>(<span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;Pedro&#34;</span>, <span style="color:#d14">&#34;Carla&#34;</span>, <span style="color:#d14">&#34;María&#34;</span>), times <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>),  
</span></span><span style="display:flex;"><span>            year <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;2014&#34;</span>, <span style="color:#d14">&#34;2015&#34;</span>, <span style="color:#d14">&#34;2016&#34;</span>), each <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>),
</span></span><span style="display:flex;"><span>            salario <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">100</span>, <span style="color:#099">400</span>, <span style="color:#099">200</span>, <span style="color:#099">500</span>, <span style="color:#099">600</span>, <span style="color:#099">700</span>, <span style="color:#099">200</span>, <span style="color:#099">250</span>,<span style="color:#099">900</span>) )
</span></span><span style="display:flex;"><span>data_3
</span></span></code></pre></div><table>
<thead>
<tr>
<th style="text-align:center">names</th>
<th style="text-align:center">year</th>
<th style="text-align:center">salario</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Pedro</td>
<td style="text-align:center">2014</td>
<td style="text-align:center">100</td>
</tr>
<tr>
<td style="text-align:center">Carla</td>
<td style="text-align:center">2014</td>
<td style="text-align:center">400</td>
</tr>
<tr>
<td style="text-align:center">María</td>
<td style="text-align:center">2014</td>
<td style="text-align:center">200</td>
</tr>
<tr>
<td style="text-align:center">Pedro</td>
<td style="text-align:center">2015</td>
<td style="text-align:center">500</td>
</tr>
<tr>
<td style="text-align:center">Carla</td>
<td style="text-align:center">2015</td>
<td style="text-align:center">600</td>
</tr>
<tr>
<td style="text-align:center">María</td>
<td style="text-align:center">2015</td>
<td style="text-align:center">700</td>
</tr>
<tr>
<td style="text-align:center">Pedro</td>
<td style="text-align:center">2016</td>
<td style="text-align:center">200</td>
</tr>
<tr>
<td style="text-align:center">Carla</td>
<td style="text-align:center">2016</td>
<td style="text-align:center">250</td>
</tr>
<tr>
<td style="text-align:center">María</td>
<td style="text-align:center">2016</td>
<td style="text-align:center">900</td>
</tr>
</tbody>
</table>
<p>Table 3: Tabla 3: Salario de 3 personas (long format)</p>
<p>Este formato, formato long, es más difícil de leer para nosotros, pero es más eficiente para los ordenadores. Y los datos los procesan los ordenadores!!</p>
<p>Generalmente, cuando estemos trabajando con los datos con el tidyverse convendrá que los datos estén en formato long, pero habrá veces, por ejemplo para mostrar tablas, tendremos que pasarlos a formato ancho. ¿Cómo podemos pasar un df de formato long a wide y al contrario? Lo más habitual es usar dos funciones del paquete <code>tidyr</code>. Veámoslo.</p>
<br>




<h3 id="pivot_longer-y-pivot_wider">pivot_longer() y pivot_wider()
  <a href="#pivot_longer-y-pivot_wider"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>




<h4 id="funciones-para-pasar-de-wide-a-long--viceversa">funciones para pasar de wide a long (&amp; viceversa)
  <a href="#funciones-para-pasar-de-wide-a-long--viceversa"></a>
</h4>
<br>
<p>Ya hemos dicho que los packages del tidyverse trabajan mejor con tidy data en <strong>formato “long”</strong>. ¿Qué hacemos si tenemos un dataframe en formato wide? Pues pasarlo a long. Afortunadamente tenemos un pkg que hace muy sencillo pasar los datos de wide a long (y viceversa): <code>tidyr</code>. Concretamente usaremos las funciones <code>pivot_longer()</code> y <code>pivot_wider()</code><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<p>
<a href="https://www.tidyverse.org/blog/2020/05/tidyr-1.1.0/" target="_blank" rel="noopener">Aquí</a> tienes el post oficial donde se anunciaba la llegada a CRAN de <code>tidyr 1.0.0</code> y 
<a href="https://tidyr.tidyverse.org/articles/pivot.html" target="_blank" rel="noopener">aquí</a> y 
<a href="https://blog.methodsconsultants.com/posts/data-pivoting-with-tidyr/" target="_blank" rel="noopener">aquí</a> un post detallado sobre ellas. La conclusión del autor del último de ellos es:</p>
<blockquote>
<p>The new tidyr functions have intuitive syntax, are easy to use, and are more flexibile than the prior functions. Several of the new arguments and features are extremely useful, and will save lots of time on common tasks.</p>
</blockquote>
<p>En este 
<a href="https://fromthebottomoftheheap.net/2019/10/25/pivoting-tidily/" target="_blank" rel="noopener">otro post</a> tienes también una explicación detallada, de <code>pivot_*()</code> pero además incluye una serie de gifs que ejemplifican el paso de wide a long.</p>
<br>




<h4 id="de-wide-a-long-format-con-pivot_longer">De wide a long format con <code>pivot_longer()</code>
  <a href="#de-wide-a-long-format-con-pivot_longer"></a>
</h4>
<p>La función <code>pivot_longer()</code> convierte dataframes de wide a long format</p>
<p>Hagámoslo:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(tidyr)
</span></span><span style="display:flex;"><span>data_wide <span style="color:#000;font-weight:bold">&lt;-</span> data_2   <span style="color:#998;font-style:italic">#- data_2 está en formato ancho (wide)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- la función pivot_longer() transforma los datos de formato ancho(wide) a formato largo(long)</span>
</span></span><span style="display:flex;"><span>data_long <span style="color:#000;font-weight:bold">&lt;-</span> data_wide <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">pivot_longer</span>(cols <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">4</span>, names_to <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;periodo&#34;</span>)
</span></span></code></pre></div><p>Si quisiéramos arreglar los valores de los periodos:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#(!!) stringr::str_replace encuentra el texto &#34;W_&#34; en la columna &#34;periodo&#34; y lo sustituye por &#34;&#34;</span>
</span></span><span style="display:flex;"><span>data_long <span style="color:#000;font-weight:bold">&lt;-</span> data_long <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(periodo <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">str_replace</span>(periodo, <span style="color:#d14">&#34;W_&#34;</span>, <span style="color:#d14">&#34;&#34;</span> ))
</span></span></code></pre></div><br>




<h4 id="de-long-a-wide-format-con-pivot_wider">De long a wide format con <code>pivot_wider()</code>
  <a href="#de-long-a-wide-format-con-pivot_wider"></a>
</h4>
<p>Pasar pasar de long a wide, tidyr tiene la función <code>pivot_longer()</code></p>
<p>Hagámoslo:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- `pivot_longer()` convierte un df de long a wide</span>
</span></span><span style="display:flex;"><span>data_wide2 <span style="color:#000;font-weight:bold">&lt;-</span> data_long <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">pivot_wider</span>(names_from <span style="color:#000;font-weight:bold">=</span> periodo, values_from <span style="color:#000;font-weight:bold">=</span> value)
</span></span></code></pre></div><br>




<h3 id="separate-y-unite">separate() y unite()
  <a href="#separate-y-unite"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>




<h4 id="funciones-para-separar-y-unir-columnas">funciones para separar y unir columnas
  <a href="#funciones-para-separar-y-unir-columnas"></a>
</h4>
<br>
<p>El pkg tidyr contiene otras 2 funciones: <code>separate()</code> y <code>unite()</code> que facilitan el separar y unir columnas. Veamos un ejemplo:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>df <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">data.frame</span>( names <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;Pedro_Navaja&#34;</span>, <span style="color:#d14">&#34;Bob_Dylan&#34;</span>, <span style="color:#d14">&#34;Cid_Campeador&#34;</span>), 
</span></span><span style="display:flex;"><span>                  year  <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1978</span>, <span style="color:#099">1941</span>, <span style="color:#099">1048</span>) )
</span></span><span style="display:flex;"><span>df
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;           names year</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 1  Pedro_Navaja 1978</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 2     Bob_Dylan 1941</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 3 Cid_Campeador 1048</span>
</span></span></code></pre></div><p>Separamos la primera columna:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>df_a <span style="color:#000;font-weight:bold">&lt;-</span> df <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">separate</span>(names, <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;Nombre&#34;</span>, <span style="color:#d14">&#34;Apellido&#34;</span>), sep <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;_&#34;</span>)
</span></span><span style="display:flex;"><span>df_a
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   Nombre  Apellido year</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 1  Pedro    Navaja 1978</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 2    Bob     Dylan 1941</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 3    Cid Campeador 1048</span>
</span></span></code></pre></div><p>Si queremos volver a unirlos, tendríamos que:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>df_b <span style="color:#000;font-weight:bold">&lt;-</span> df_a <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">unite</span>(Nombre_y_Apellido, Nombre<span style="color:#000;font-weight:bold">:</span>Apellido, sep <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&amp;&#34;</span>)
</span></span><span style="display:flex;"><span>df_b
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   Nombre_y_Apellido year</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 1      Pedro&amp;Navaja 1978</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 2         Bob&amp;Dylan 1941</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 3     Cid&amp;Campeador 1048</span>
</span></span></code></pre></div><br>




<h4 id="mas-funciones-de-tidyr">mas funciones de tidyr
  <a href="#mas-funciones-de-tidyr"></a>
</h4>
<p>Además, recuerda que el paquete <code>tidyr</code> tiene muchas 
<a href="https://tidyr.tidyverse.org/reference/index.html" target="_blank" rel="noopener">más funciones</a> que nos facilitan conseguir que nuestros datos sean <strong>tidy</strong>.</p>
<br>
<br>
<hr>




<h1 id="3-dplyr">3. DPLYR
  <a href="#3-dplyr"></a>
</h1>
<p>En R hay varios enfoques para manipular datos en R, pero el más habitual, de hecho se ha convertido en el estándar, es utilizar el tidyverse, concretamente el paquete 
<a href="https://dplyr.tidyverse.org/" target="_blank" rel="noopener"><code>dplyr</code></a>.</p>
<p><code>dplyr</code> es un paquete que permite manipular datos de forma intuitiva. Tiene 6-7 funciones o verbos principales. Cada uno de ellos hace “una sola cosa”, así que para realizar transformaciones complejas hay que ir concatenando instrucciones sencillas. Esto se hace con el <strong>operador pipe</strong> (<code>%&gt;%</code>)</p>
<br>
<hr>




<h2 id="dplyr-basics">dplyr basics
  <a href="#dplyr-basics"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Tras mucho pensar como estructurábamos este apartado del tutorial, al final me decanté por utilizar los materiales del curso STAT 545. ¿que quien ha se encarga del curso? Pues Jenny Bryan (always rocks!!). Puedes encontrarlos 
<a href="http://stat545.com/block009_dplyr-intro.html" target="_blank" rel="noopener">aquí</a>.</p>
<p><code>dplyr</code> tiene muchas funciones, pero las principales son 6-7, luego las veremos. Con ellas se pueden resolver la mayoría de problemas asociados a la manipulación de datos.</p>
<p>Cada función (o verbo) hace una sola cosa, pero concatenándolas con <code>%&gt;%</code> permiten resolver cuestiones complejas.</p>
<p>Todas las funciones tienen una estructura o comportamiento similar:</p>
<ul>
<li>el primer argumento siempre es un df. Esto es importante</li>
<li>los siguientes argumentos describen que hacer con los datos</li>
<li>el resultado es siempre un nuevo df. Esto es importante</li>
</ul>
<p>Por ejemplo, <code>filter(df, X1 &gt;= 10)</code> devuelve un df con las filas del df original que cumplen la condición de que la variable X1 es mayor o igual a 10</p>
<p>Podemos escribir la anterior instrucción de 3 formas. La más utilizada es la última:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>df_new <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">filter</span>(df, X1 <span style="color:#000;font-weight:bold">&gt;=</span> <span style="color:#099">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df_new <span style="color:#000;font-weight:bold">&lt;-</span> df <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(. , X1 <span style="color:#000;font-weight:bold">&gt;=</span> <span style="color:#099">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df_new <span style="color:#000;font-weight:bold">&lt;-</span> df <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(X1 <span style="color:#000;font-weight:bold">&gt;=</span> <span style="color:#099">10</span>)
</span></span></code></pre></div><br>
<hr>




<h1 id="4-principales-funciones-de-dplyr">4. Principales funciones de dplyr
  <a href="#4-principales-funciones-de-dplyr"></a>
</h1>
<p>Hay 6-7 principales.</p>
<ul>
<li><code>filter()</code> : permite seleccionar filas (que cumplen una o varias condiciones)</li>
<li><code>arrange()</code>: reordena las filas (<code>arrange()</code>).</li>
<li><code>rename()</code> : cambia los nombres de las columnas (variables)</li>
<li><code>select()</code> : selecciona columnas (variables)</li>
<li><code>mutate()</code> : crea nuevas variables</li>
<li><code>summarise()</code> : resume (colapsa) unos cuantos valores a uno sólo. Por ejemplo, calcula la media, moda, etc… de un conjunto de valores</li>
</ul>
<p>Hay una séptima:</p>
<ul>
<li><code>group_by()</code> : permite agrupar filas en función de una o varias condiciones</li>
</ul>
<p>Y después de <code>dplyr 1.0.0</code>, en mayo de 2020, añado 2 más:</p>
<ul>
<li><code>across()</code> y <code>where()</code>. Estas funciones son un poco diferentes, solo se usan en combinación de otro función/verbo. Son 2 funciones que en la jerga del tidyverse no son verbos sino adverbios. Lo vemos</li>
</ul>
<br>
<p>Veámoslas una a una. Veremos sólo algunos ejemplos. Ya iremos practicando</p>
<br>
<hr>




<h2 id="filter"><code>filter()</code>
  <a href="#filter"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Esta función (o verbo) se utiliza para <strong>seleccionar filas</strong> de un dataframe (df). Se seleccionan las filas que cumplen una determinada condición o criterio lógico. Por ejemplo:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- vamos a trabajar con los datos del [pkg gapminder](https://github.com/jennybc/gapminder)</span>
</span></span><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">&lt;-</span> gapminder<span style="color:#000;font-weight:bold">::</span>gapminder
</span></span></code></pre></div><br>
<p>Seleccionamos las filas que cumplen determinados criterios:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- Observaciones de España (country == &#34;Spain&#34;)</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(country <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;Spain&#34;</span>) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- filas con valores de &#34;lifeExp&#34; &lt; 29</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(lifeExp <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">29</span>)       
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- filas con valores de &#34;lifeExp&#34; entre [29, 32]</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(lifeExp <span style="color:#000;font-weight:bold">&gt;=</span>  <span style="color:#099">29</span> , lifeExp <span style="color:#000;font-weight:bold">&lt;=</span> <span style="color:#099">32</span>)   
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(lifeExp <span style="color:#000;font-weight:bold">&gt;=</span>  <span style="color:#099">29</span> <span style="color:#000;font-weight:bold">&amp;</span>  lifeExp <span style="color:#000;font-weight:bold">&lt;=</span> <span style="color:#099">32</span>)  
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(<span style="color:#900;font-weight:bold">between</span>(lifeExp, <span style="color:#099">29</span>, <span style="color:#099">32</span>))       
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- observaciones de paises de África con lifeExp &gt; 32</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(lifeExp <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">72</span> <span style="color:#000;font-weight:bold">&amp;</span>  continent <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;Africa&#34;</span>) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- observaciones de países de África o Asia con lifeExp &gt; 32</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(lifeExp <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">72</span> <span style="color:#000;font-weight:bold">&amp;</span>  continent <span style="color:#000;font-weight:bold">%in%</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;Africa&#34;</span>, <span style="color:#d14">&#34;Asia&#34;</span>) )  
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(lifeExp <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">72</span> <span style="color:#000;font-weight:bold">&amp;</span> (continent <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;Africa&#34;</span> <span style="color:#000;font-weight:bold">|</span> continent <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;Asia&#34;</span>) )  
</span></span></code></pre></div><br>
<p>La función <code>filter()</code> tiene muchas más posibilidades. Ya las iremos viendo. PERO si quieres ver un resumen de las posibilidades del paquete dplyr mira su 
<a href="https://www.rstudio.com/resources/cheatsheets/" target="_blank" rel="noopener">CHEAT SHEET</a>. <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>. La 
<a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" target="_blank" rel="noopener">versión antigua</a> de la Cheat sheet contiene también las funciones de <code>tidyr</code>.</p>
<br>




<h4 id="slice-también-es-muy-útil-para-seleccionar-filas"><code>slice()</code> también es muy útil para seleccionar filas
  <a href="#slice-tambi%c3%a9n-es-muy-%c3%batil-para-seleccionar-filas"></a>
</h4>
<ul>
<li><code>slice()</code>: filtra filas por su posición (física en el df)</li>
</ul>
<br>
<p>Como dijimos, <code>slice()</code> sirve para seleccionar filas por posición:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- selecciona las observaciones de la décima a la quinceava</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">slice</span>(<span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">15</span>)) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- selecciona las observaciones de la 12 a 13 Y de la 44 a 46, Y las 4 últimas</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">slice</span>( <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">14</span>, <span style="color:#099">44</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">46</span>, <span style="color:#900;font-weight:bold">n</span>()<span style="color:#099">-4</span><span style="color:#000;font-weight:bold">:</span><span style="color:#900;font-weight:bold">n</span>()) ) <span style="color:#998;font-style:italic">#- AQUI hay un error, tenéis que arreglarlo. </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- Pista: igual os ayuda crear una columna con el índice de rows y repetir el cálculo</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(index <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#900;font-weight:bold">n</span>())
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">slice</span>( <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">14</span>, <span style="color:#099">44</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">46</span>, <span style="color:#900;font-weight:bold">n</span>()<span style="color:#099">-4</span><span style="color:#000;font-weight:bold">:</span><span style="color:#900;font-weight:bold">n</span>()) )
</span></span></code></pre></div><br>




<h4 id="variantes-de-slice">variantes de <code>slice()</code>
  <a href="#variantes-de-slice"></a>
</h4>
<p>Hay varias variantes de <code>slice()</code>. Concretamente <code>slice_max()</code> <code>slice_min()</code>, <code>slice_smpl()</code>, <code>slice_head()</code> <code>slice_tail()</code>. Veremos algún ejemplo con las 3 primeras.</p>
<p>Si queremos seleccionar las filas que tienen el valor máximo (o mínimo) de una determinada variable, podemos usar <code>slice_max()</code> y <code>slice_min()</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- selecciona las 3 filas con mayor valor de lifeExp</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">slice_max</span>(lifeExp, n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>)
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- selecciona las 4 filas con MENOR valor de pop</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">slice_min</span>(pop, n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>)
</span></span></code></pre></div><p>Para ver la potencialidad de una función tienes que ver su ayuda interna (presionando F1 o con <code>help()</code>). Por ejemplo <code>slice_min()</code> tiene otro argumento (<code>prop</code>) que nos permite calcular, por ejemplo, el 10% de observaciones/países con menor esperanza de vida.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- observaciones en el primer decil en cuanto a esperanza de vida, 10% con menor esperanza de vida</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">slice_min</span>(lifeExp, prop <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.1</span>)
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- 1% de observaciones con mayor población. Imagino que estarán China e India</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">slice_max</span>(pop, prop <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.01</span>)
</span></span></code></pre></div><p>A veces se necesita obtener una muestra aleatoria de los datos. La función <code>slice_sample()</code> está diseñada para ayudarnos en esta tarea:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- selecciona (aleatoriamente) 100 filas de los datos</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">slice_sample</span>(n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">100</span>)
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- selecciona (aleatoriamente) un 5% de los datos</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">slice_sample</span>(prop <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.05</span>)
</span></span></code></pre></div><br>
<hr>




<h2 id="arrange"><code>arrange()</code>
  <a href="#arrange"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Esta función (o verbo) se utiliza para <strong>reordenar las filas</strong> de un dataframe (df).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- ordena las filas de MENOR a mayor según los valores de la v. lifeExp </span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">arrange</span>(lifeExp)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- ordena las filas de MAYOR a menor según los valores de la v. lifeExp</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">arrange</span>(<span style="color:#900;font-weight:bold">desc</span>(lifeExp))  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- ordenada las filas de MENOR a mayor según los valores de la v. lifeExp. </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- Si hay empates se resuelve con la variable &#34;pop&#34;</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">arrange</span>(lifeExp, pop) 
</span></span></code></pre></div><br>
<hr>




<h2 id="rename"><code>rename()</code>
  <a href="#rename"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Esta función permite cambiar los nombres de las columnas</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- cambia los nombres de lifeExp y gdpPercap a life_exp y gdp_percap </span>
</span></span><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">rename</span>(life_exp <span style="color:#000;font-weight:bold">=</span> lifeExp,  gdp_percap <span style="color:#000;font-weight:bold">=</span> gdpPercap)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#-(!!) la función names() de R-base es muy útil. Tb setNames() y set_names()</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">names</span>(aa) <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">names</span>(aa) <span style="color:#000;font-weight:bold">%&gt;%</span> toupper
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">names</span>(aa) <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">names</span>(aa) <span style="color:#000;font-weight:bold">%&gt;%</span> tolower
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">names</span>(aa) <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;var_01&#34;</span>, <span style="color:#d14">&#34;var_02&#34;</span>, <span style="color:#d14">&#34;var_03&#34;</span>, <span style="color:#d14">&#34;var_04&#34;</span>, <span style="color:#d14">&#34;var_05&#34;</span> , <span style="color:#d14">&#34;var_06&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">names</span>(aa) <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">paste0</span>(<span style="color:#d14">&#34;Var_&#34;</span>, <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">6</span>)
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">names</span>(aa) <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">paste0</span>(<span style="color:#d14">&#34;Lag_&#34;</span>, <span style="color:#900;font-weight:bold">formatC</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">6</span>, width <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>, flag <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;0&#34;</span>)) 
</span></span></code></pre></div><br>




<h4 id="rename_with--una-variante-de-rename">rename_with() , una variante de rename()
  <a href="#rename_with--una-variante-de-rename"></a>
</h4>
<p>Si tienes que hacer transformaciones más complejas, que requieran el uso de funciones o pautas, de los nombres de las variables puedes usar <code>rename_with()</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">rename_with</span>(aa, toupper)
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">rename_with</span>(aa, toupper, <span style="color:#900;font-weight:bold">starts_with</span>(<span style="color:#d14">&#34;Life&#34;</span>) <span style="color:#000;font-weight:bold">|</span> <span style="color:#900;font-weight:bold">contains</span>(<span style="color:#d14">&#34;countr&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">rename_with</span>(aa, <span style="color:#000;font-weight:bold">~</span> <span style="color:#900;font-weight:bold">str_replace</span>(.x, <span style="color:#d14">&#34;e&#34;</span>, <span style="color:#d14">&#34;Ö&#34;</span>))  <span style="color:#998;font-style:italic">#- (!!!!)</span>
</span></span></code></pre></div><br>
<p>La función <code>rename()</code> es útil pero, enseguida veremos que la siguiente función, <code>select()</code>, también permite renombrar las columnas, e incluso reordenar la posición de estas.</p>
<br>
<hr>




<h2 id="select"><code>select()</code>
  <a href="#select"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Esta función (o verbo) sirve para <strong>seleccionar columnas</strong> de un df.</p>




<h4 id="seleccionar-variables-por-nombre">seleccionar variables por nombre
  <a href="#seleccionar-variables-por-nombre"></a>
</h4>
<p>Seleccionamos las variables “year” y “lifeExp”:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- Se lee como: “Take el df gapminder, then select the variables year and lifeExp”</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(year, lifeExp) 
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(<span style="color:#900;font-weight:bold">c</span>(year, lifeExp))
</span></span></code></pre></div><br>




<h4 id="quitar-variables">quitar variables
  <a href="#quitar-variables"></a>
</h4>
<p>Para eliminar una variable hay varias formas:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(<span style="color:#000;font-weight:bold">-</span>year)   <span style="color:#998;font-style:italic">#- la forma mas habitual</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- estas dos formas son mucho menos habituales</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(<span style="color:#000;font-weight:bold">!</span>year)   
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(year <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">NULL</span>)   <span style="color:#998;font-style:italic">#- aún no hemos visto mutate()</span>
</span></span></code></pre></div><p>Para eliminar varias variables:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- quitamos las variables: year y lifeExp</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(<span style="color:#000;font-weight:bold">-</span><span style="color:#900;font-weight:bold">c</span>(year, lifeExp))
</span></span></code></pre></div><br>




<h4 id="seleccionar-por-posición">seleccionar por posición
  <a href="#seleccionar-por-posici%c3%b3n"></a>
</h4>
<p>Seleccionamos las variables del df gapminder siguientes: de la primera a la tercera y también la quinta (mejor seleccionarlas por nombre!!)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- seleccionamos las variables {1, 2, 3 y 5}</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">3</span>, <span style="color:#099">5</span>)
</span></span></code></pre></div><br>




<h4 id="quitar-variables-por-posición">quitar variables por posición
  <a href="#quitar-variables-por-posici%c3%b3n"></a>
</h4>
<p>Seleccionamos todas las variables del df gapminder <strong>excepto</strong> las siguientes: de la primera a la tercer y la quinta (mejor seleccionarlas por nombre)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- quitamos las variables {1, 2, 3 y 5}</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(<span style="color:#000;font-weight:bold">-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">3</span>, <span style="color:#099">5</span>))
</span></span></code></pre></div><br>




<h4 id="select-con-la-función-auxiliar-where"><code>select()</code> con la función auxiliar <code>where()</code>
  <a href="#select-con-la-funci%c3%b3n-auxiliar-where"></a>
</h4>
<p>En el data.frame <code>gapminder</code> las 2 primeras variables (country y continent) son factores y las 4 siguientes son variable numéricas.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">print</span>(gapminder, n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>)
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # A tibble: 1,704 x 6</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   country     continent  year lifeExp      pop gdpPercap</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 1 Afghanistan Asia       1952    28.8  8425333      779.</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 2 Afghanistan Asia       1957    30.3  9240934      821.</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 3 Afghanistan Asia       1962    32.0 10267083      853.</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # … with 1,701 more rows</span>
</span></span></code></pre></div><p>Imagina que queremos seleccionar sólo las variables que son numéricas. Podemos hacerlo por nombre o por posición pero mejor con <code>select()</code> y la función auxiliar <code>where()</code><sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(is.numeric)        <span style="color:#998;font-style:italic">#- funciona, pero ...</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(<span style="color:#900;font-weight:bold">where</span>(is.numeric)) <span style="color:#998;font-style:italic">#- es &#34;preferible&#34; esta segunda expresión</span>
</span></span></code></pre></div><p><code>select()</code> y <code>where()</code> son dos funciones, sí, pero en la jerga del tidyverse, <code>select()</code> es un verbo y <code>where()</code> es un adverbio, cualifica/cambia lo que hace <code>select()</code>.</p>
<p>Si quisiéramos seleccionar las variables que no son numéricas haríamos:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(<span style="color:#000;font-weight:bold">!</span>is.numeric)
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(<span style="color:#000;font-weight:bold">!</span><span style="color:#900;font-weight:bold">where</span>(is.numeric))  <span style="color:#998;font-style:italic">#- es preferible esta segunda expresión</span>
</span></span></code></pre></div><br>
<p>La función <code>select()</code> tiene muchas más posibilidades. ya las iremos viendo. PERO si quieres ver un resumen de las posibilidades del pkg dplyr mira su 
<a href="https://www.rstudio.com/resources/cheatsheets/" target="_blank" rel="noopener">CHEAT SHEET</a>.</p>
<br>




<h4 id="renombrando-y-reordenando-columnas-con-select">renombrando y reordenando columnas con <code>select()</code>
  <a href="#renombrando-y-reordenando-columnas-con-select"></a>
</h4>
<p>Lo que sí vamos a ver son 2 posibilidades de <code>select()</code> que son muy útiles. Con <code>select()</code> podemos: <strong>renombrar</strong> y <strong>reordenar</strong> las columnas:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- dejamos en aa solamente a las columnas &#34;year&#34; y &#34;pop&#34;; ADEMÁS, ahora, &#34;pop&#34; irá antes que &#34;year&#34;</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(pop, year)
</span></span></code></pre></div><br>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- dejamos en aa solamente a las columnas &#34;year&#34; y &#34;pop&#34; y les cambiamos el nombre</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(poblacion <span style="color:#000;font-weight:bold">=</span> pop, año <span style="color:#000;font-weight:bold">=</span> year)
</span></span></code></pre></div><br>
<p>Imagina que quieres que la última columna pase a ser la primera (manías!!). Podemos hacerlo con select y <code>everything()</code>. everything es una <strong>función auxiliar</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- &#34;gdpPercap&#34; que es la última columna pasa a ser la primera</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(gdpPercap, <span style="color:#900;font-weight:bold">everything</span>())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#(!!) otras 3 formas de hacer lo mismo: que la última columna pase a ser la primera</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(<span style="color:#900;font-weight:bold">ncol</span>(df), <span style="color:#900;font-weight:bold">everything</span>())
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(<span style="color:#900;font-weight:bold">length</span>(df), <span style="color:#900;font-weight:bold">everything</span>())
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(<span style="color:#900;font-weight:bold">last_col</span>(), <span style="color:#900;font-weight:bold">everything</span>())  <span style="color:#998;font-style:italic">#- usamos the selection helper last_col()</span>
</span></span></code></pre></div><p>En la última instrucción hemos usado dos funciones auxiliares de select(), dos “helper functions”. La lista completa de funciones auxiliares para select() puedes verla 
<a href="https://tidyselect.r-lib.org/reference/select_helpers.html" target="_blank" rel="noopener">aquí</a>.</p>
<br>




<h4 id="relocate"><code>relocate()</code>
  <a href="#relocate"></a>
</h4>
<p>Desde dplyr 1.0.0, tenemos otra función para reordenar las variables de un data.frame: <code>relocate()</code>. Veámosla en acción:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> dplyr<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">relocate</span>(country, .after <span style="color:#000;font-weight:bold">=</span> lifeExp)
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> dplyr<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">relocate</span>(country, .before <span style="color:#000;font-weight:bold">=</span> lifeExp)
</span></span></code></pre></div><p>Las opciones <code>.after</code> y <code>.before</code> también están disponibles en <code>mutate()</code>, la siguiente función que presentaremos.</p>
<br>
<br>
<hr>




<h2 id="mutate"><code>mutate()</code>
  <a href="#mutate"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Esta función (o verbo) sirve para <strong>crear nuevas variables</strong> (columnas). Lógicamente, es muy útil en análisis de datos.</p>
<p>Creamos la variable: <code>GDP = pop*gdpperCap</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- Creamos la variable: GDP = pop*gdpperCap</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(GDP <span style="color:#000;font-weight:bold">=</span> pop<span style="color:#000;font-weight:bold">*</span>gdpPercap)
</span></span></code></pre></div><p>Por defecto, la nueva variable creada se situará al final del data frame, a no ser que usemos los argumentos <code>.after</code> y <code>.before</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(GDP <span style="color:#000;font-weight:bold">=</span> pop<span style="color:#000;font-weight:bold">*</span>gdpPercap, .after <span style="color:#000;font-weight:bold">=</span> country)
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(GDP <span style="color:#000;font-weight:bold">=</span> pop<span style="color:#000;font-weight:bold">*</span>gdpPercap, .before <span style="color:#000;font-weight:bold">=</span> country)
</span></span></code></pre></div><p><code>mutate()</code> también tiene un argumento(<code>.keep</code>) para controlar que variables permanecen en el data frame. Por ejemplo, en el chunk de abajo dejaremos solo las variables usadas.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(GDP <span style="color:#000;font-weight:bold">=</span> pop<span style="color:#000;font-weight:bold">*</span>gdpPercap, .keep <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;used&#34;</span>)
</span></span></code></pre></div><br>
<hr>




<h2 id="summarise"><code>summarise()</code>
  <a href="#summarise"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Esta función (o verbo) sirve para <strong>RESUMIR</strong> (o “colapsar filas”). Coge una variable o grupo de valores como input y devuelve un solo valor; por ejemplo, haya la media aritmética (o el mínimo, o el máximo …) de una columna/variable.</p>
<br>
<p>Obtengamos determinados estadísticos de <strong>una variable</strong>. Para esto no nos hace falta <code>dplyr</code> pero conviene ir habituándose a su sintaxis.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- retornará un único valor: la media global de la v. &#34;lifeExp&#34;</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(media <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(lifeExp))  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- retornará un único valor: el número de filas</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(NN <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">n</span>())  
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">count</span>()                <span style="color:#998;font-style:italic">#- más adelante veremos la utilidad de count()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- retornará un único valor: la desviación típica de la v. &#34;lifeExp&#34;</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(desviacion_tipica <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">sd</span>(lifeExp))  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- retornará un único valor: el máximo de la variable &#34;pop&#34;</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">max</span>(pop))  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- retornará 2 valores: la media y sd de la v. &#34;lifeExp&#34;</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">mean</span>(lifeExp), <span style="color:#900;font-weight:bold">sd</span>(lifeExp))  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- retornará 2 valores: las medias de &#34;lifeExp&#34; y &#34;gdpPercap&#34;</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">mean</span>(lifeExp), <span style="color:#900;font-weight:bold">mean</span>(gdpPercap))  
</span></span></code></pre></div><br>




<h4 id="across-y-where"><code>across()</code> y <code>where()</code>
  <a href="#across-y-where"></a>
</h4>
<p>Antes de pasar a ver <code>group_by()</code>, vamos a utilizar las 2 nuevas funciones <code>across()</code> y <code>where()</code>.</p>
<p>Muchas veces en un trabajo se han de calcular estadísticos de <strong>todas las variables</strong> del df. Esto se hace con <code>summarise()</code>, PERO utilizando también una función de ayuda (helper function): <code>across()</code><sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>. A veces también hay que usar otra helper function: <code>where()</code>.</p>
<p>La sintaxis de <code>across()</code> es:</p>
<p><code>across(.cols = everything(), .fns = NULL, ..., .names = NULL)</code>; es decir,</p>
<p><code>across(&quot;columnas seleccionadas&quot;, &quot;funciones o cálculos a realizar&quot;, &quot;si quieres controlar los nombres&quot;))</code>.</p>
<p>Si al seleccionar las columnas utilizas algún criterio lógico, como por ejemplo <code>is.numeric()</code>, entonces la sintaxis de <code>across()</code> es un poco diferente; concretamente será:</p>
<p><code>across( where(&quot;columnas seleccionadas&quot;), &quot;funciones o cálculos a realizar&quot;, &quot;si quieres controlar los nombres&quot;))</code></p>
<p>Los ejemplos ayudan a entenderlo:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- media de cada una de las 6 variables. Devuelve 2 warnings porque las 2 primeras son textuales. No se puede calcular la media de continent y country</span>
</span></span><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#900;font-weight:bold">everything</span>(), mean) ) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- calculamos la media de tercera a la sexta variable</span>
</span></span><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#099">3</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">6</span>, mean) ) 
</span></span></code></pre></div><p>Lo que os decía de seleccionar columnas con un criterio lógico y usar <code>where()</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#900;font-weight:bold">where</span>(is.numeric), mean)) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- con los nombres de los argumentos (más largo pero conviene verlo de vez en cuando)</span>
</span></span><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">across</span>(.cols <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">where</span>(is.numeric), .fns <span style="color:#000;font-weight:bold">=</span> mean)) 
</span></span></code></pre></div><p>Vamos a calcular cosas un poco más complejas. Imagina que no sólo quieres calcular la media sino que también quieres calcular la desviación típica. Seguiremos usando <code>summarise()</code> y <code>across()</code>. Lo único nuevo es que como vamos a aplicar dos funciones (<code>mean()</code> y <code>sd()</code>) las tenemos que poner dentro de <code>list()</code>. Tiene sentido, es una lista de funciones a aplicar a las columnas que seleccionemos con <code>across()</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- calculamos la media y desviación típica de las columnas 3 a 6.</span>
</span></span><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#099">3</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">6</span>, <span style="color:#900;font-weight:bold">list</span>(media <span style="color:#000;font-weight:bold">=</span> mean, desv <span style="color:#000;font-weight:bold">=</span> sd)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- lo mismo, pero explicitando los nombres de los argumentos</span>
</span></span><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">across</span>(.cols <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">6</span>, .fns <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">list</span>(media <span style="color:#000;font-weight:bold">=</span> mean, desv <span style="color:#000;font-weight:bold">=</span> sd) ))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- lo mismo otra vez, pero eligiendo el nombre de las variables que se van aa crear con .names</span>
</span></span><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#099">3</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">6</span>, <span style="color:#900;font-weight:bold">list</span>(media <span style="color:#000;font-weight:bold">=</span> mean, desv <span style="color:#000;font-weight:bold">=</span> sd), .names <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;{fn}_{col}&#34;</span>))
</span></span></code></pre></div><p>(!!!)Imagina que quisiéramos presentar en una tabla los anteriores resultados; tendríamos que usar <code>tidyr::pivot_longer()</code>. Lo voy a hacer por trozos. Nos va a costar un poco:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#aa &lt;- gapminder %&gt;% summarise(across(3:6, list(media = mean, desv = sd), .names = &#34;{fn}_{col}&#34;)) </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#aa1 &lt;- aa %&gt;% pivot_longer(1:8, names_to = &#34;names&#34;, values_to = &#34;values&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#aa2 &lt;- aa1 %&gt;% separate(names, into = c(&#34;operacion&#34;, &#34;variable&#34;), sep =  &#34;_&#34;) %&gt;% </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#               select(variable, everything())</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#aa3 &lt;- aa2 %&gt;% pivot_wider(1:3, names_from = operacion, values_from = values)</span>
</span></span></code></pre></div><p>Lo practicaremos, y veremos métodos más sencillos para hacer tablas con estadísticos descriptivos, pero eso será en el tutorial dedicado a tablas; pero no os olvidéis de <code>across()</code> que luego tenemos que volver a ella.
<br></p>
<hr>




<h2 id="group_by"><code>group_by()</code>
  <a href="#group_by"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Con esta función ya empezaremos a ver la potencia de dplyr. En análisis de datos muchas operaciones (media etc..) queremos calcularlas para distintos grupos (hombre, mujer …). <code>group_by()</code> permite hacerlo.</p>
<p><code>group_by()</code>coge un df y lo convierte en un <strong>“df agrupado”</strong>. En ese nuevo “df agrupado”, las operaciones que hagamos con <code>summarise()</code> se harán por separado para cada uno de los grupos que hayamos definido. Ahora lo vemos.</p>
<p>Si, por ejemplo, agrupamos un df por países, al ejecutar <code>summarise()</code>, nos retornará una fila con el resultado para cada país. En realidad, podemos pensar que <code>group_by()</code> no hace “nada”, que en realidad solo cambia lo que hacen las otras funciones: ahora los cálculos se harán para cada uno de los grupos que define <code>group_by()</code></p>
<br>
<hr>
<p>Como dice Jenny: Let’s start with simple counting. ¿Cuantas observaciones(rows) tenemos por continente?</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- cogemos df y lo (des)agrupamos por grupos definidos por la variable &#34;continent&#34;; osea, habrá 5 grupos</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- después con summarise() calcularemos el nº de observaciones en cada continente o grupo; es decir, nos retornará un df con una fila por cada continente</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">group_by</span>(continent) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(NN <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">n</span>()) 
</span></span><span style="display:flex;"><span>aa
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # A tibble: 5 x 2</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   continent    NN</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   &lt;fct&gt;     &lt;int&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 1 Africa      624</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 2 Americas    300</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 3 Asia        396</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 4 Europe      360</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 5 Oceania      24</span>
</span></span></code></pre></div><p>Esto tan sencillo también se puede hacer con <code>count()</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">group_by</span>(continent) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">count</span>() 
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">group_by</span>(continent) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">count</span>(name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;NN&#34;</span>) 
</span></span><span style="display:flex;"><span>aa
</span></span></code></pre></div><br>
<p>¿Y cuantos países hay en la base de datos? Para este tipo de cosas, se pueden usar funciones de R-base, pero dplyr tiene muchas funciones auxiliares.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- cogemos df y lo agrupamos por &#34;continent&#34;, </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- después calculamos 2 cosas: el número de observaciones o rows</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- y el número de países en cada continente (NN_countries)</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">group_by</span>(continent) <span style="color:#000;font-weight:bold">%&gt;%</span>  
</span></span><span style="display:flex;"><span>          <span style="color:#900;font-weight:bold">summarize</span>(NN <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">n</span>(), 
</span></span><span style="display:flex;"><span>                    NN_countries <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">n_distinct</span>(country)) 
</span></span><span style="display:flex;"><span>aa
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # A tibble: 5 x 3</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   continent    NN NN_countries</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   &lt;fct&gt;     &lt;int&gt;        &lt;int&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 1 Africa      624           52</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 2 Americas    300           25</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 3 Asia        396           33</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 4 Europe      360           30</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 5 Oceania      24            2</span>
</span></span></code></pre></div><br>
<p>Calculemos la esperanza de vida media por continente</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- cogemos df y lo agrupamos por &#34;continent&#34;, después calculamos la media de &#34;lifeExp&#34;</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">group_by</span>(continent) <span style="color:#000;font-weight:bold">%&gt;%</span>  
</span></span><span style="display:flex;"><span>                    <span style="color:#900;font-weight:bold">summarize</span>(<span style="color:#900;font-weight:bold">mean</span>(lifeExp)) 
</span></span><span style="display:flex;"><span>aa
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # A tibble: 5 x 2</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   continent `mean(lifeExp)`</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   &lt;fct&gt;               &lt;dbl&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 1 Africa               48.9</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 2 Americas             64.7</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 3 Asia                 60.1</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 4 Europe               71.9</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 5 Oceania              74.3</span>
</span></span></code></pre></div><p>Guau! Hay que irse a vivir a Oceanía!!</p>
<br>
<p>Calculemos la esperanza de vida media por continente en el primer periodo (1952)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- cogemos df y filtramos para quedarnos con las observaciones de 1952</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- después lo agrupamos por &#34;continent&#34;, </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- después calculamos la media de &#34;lifeExp&#34;</span>
</span></span><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(year <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;1952&#34;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>  
</span></span><span style="display:flex;"><span>              <span style="color:#900;font-weight:bold">group_by</span>(continent) <span style="color:#000;font-weight:bold">%&gt;%</span>  
</span></span><span style="display:flex;"><span>              <span style="color:#900;font-weight:bold">summarize</span>(<span style="color:#900;font-weight:bold">mean</span>(lifeExp)) 
</span></span></code></pre></div><p>Habría sido mejor en lugar de poner <code>filter(year == &quot;1952&quot;)</code> haber puesto <code>filter(year == min(year))</code></p>
<p>Guau! Habría que haber vivido en Oceanía (en 1952)!!</p>
<br>
<p>Se pueden calcular varios estadísticos a la vez</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- cogemos df y filtramos (cogemos) las observaciones de 1952 y 2007</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- agrupamos por &#34;continent&#34;, </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- después calculamos la media de &#34;lifeExp&#34; y de &#34;gdpPercap&#34;</span>
</span></span><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(year <span style="color:#000;font-weight:bold">%in%</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1952</span>, <span style="color:#099">2007</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>  
</span></span><span style="display:flex;"><span>             <span style="color:#900;font-weight:bold">group_by</span>(continent, year) <span style="color:#000;font-weight:bold">%&gt;%</span>  
</span></span><span style="display:flex;"><span>             <span style="color:#900;font-weight:bold">summarize</span>(<span style="color:#900;font-weight:bold">mean</span>(lifeExp), <span style="color:#900;font-weight:bold">mean</span>(gdpPercap)) 
</span></span></code></pre></div><p>Vamos a hacer cálculos cada vez más complejos:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- cogemos df y lo agrupamos por &#34;continent&#34; y &#34;year&#34;, </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- después calculamos la media de &#34;lifeExp&#34; y de &#34;gdpPercap&#34;</span>
</span></span><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(year <span style="color:#000;font-weight:bold">%in%</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1952</span>, <span style="color:#099">2007</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>              <span style="color:#900;font-weight:bold">group_by</span>(continent, year) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>              <span style="color:#998;font-style:italic">#- después calculamos la media de &#34;lifeExp&#34; </span>
</span></span><span style="display:flex;"><span>              <span style="color:#900;font-weight:bold">summarise</span>(media <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(lifeExp))
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- Voy a crear un nuevo df: &#34;gapminder_gr&#34; o &#34;gapminder agrupado&#34;</span>
</span></span><span style="display:flex;"><span>gapminder_gr <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(year <span style="color:#000;font-weight:bold">%in%</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1952</span>, <span style="color:#099">2007</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#900;font-weight:bold">group_by</span>(continent, year) 
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- y sobre &#34;gapminder_gr&#34; iremos haciendo cálculos</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- si queremos calcular la media de varias variables tenemos que usar across()</span>
</span></span><span style="display:flex;"><span>gapminder_gr <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#900;font-weight:bold">c</span>(lifeExp, gdpPercap), mean))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- si queremos calcular la media de todas las variables numéricas tenemos que usar across() y where()</span>
</span></span><span style="display:flex;"><span>gapminder_gr <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#900;font-weight:bold">where</span>(is.numeric), mean))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- si queremos calcular la media y la mediana, hay que usar list()</span>
</span></span><span style="display:flex;"><span>gapminder_gr <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#900;font-weight:bold">c</span>(lifeExp, gdpPercap), 
</span></span><span style="display:flex;"><span>                            <span style="color:#900;font-weight:bold">list </span>(media <span style="color:#000;font-weight:bold">=</span> mean, mediana <span style="color:#000;font-weight:bold">=</span> median) ))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- si ponemos los nombres de los argumentos quedaría como</span>
</span></span><span style="display:flex;"><span>gapminder_gr <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">across</span>(.cols <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(lifeExp, gdpPercap), 
</span></span><span style="display:flex;"><span>                                  .fns <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">list </span>(media <span style="color:#000;font-weight:bold">=</span> mean, mediana <span style="color:#000;font-weight:bold">=</span> median)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- además, podemos controlar el nombre de las variables creadas con el argumento .names</span>
</span></span><span style="display:flex;"><span>gapminder_gr <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#900;font-weight:bold">c</span>(lifeExp, gdpPercap), 
</span></span><span style="display:flex;"><span>                        <span style="color:#900;font-weight:bold">list </span>(media <span style="color:#000;font-weight:bold">=</span> mean, mediana <span style="color:#000;font-weight:bold">=</span> median), 
</span></span><span style="display:flex;"><span>                        .names <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;{fn}_{col}&#34;</span>))
</span></span></code></pre></div><br>




<h4 id="preguntas-de-verdad">Preguntas de verdad
  <a href="#preguntas-de-verdad"></a>
</h4>
<p>Bueno, pues ya conocéis lo principal, lo básico y más importante de <code>dplyr</code>, solo queda ir cogiendo práctica y confianza, así que para ello toca hacer una serie de <strong>preguntas de verdad!!</strong>. Por ejemplo:</p>
<ol>
<li>¿en que continente ha aumentado más la esperanza de vida en el periodo 1952-2007?</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- cogemos df y lo agrupamos por &#34;continent&#34;, después calculamos la media de &#34;lifeExp&#34;</span>
</span></span><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">filter</span>(year <span style="color:#000;font-weight:bold">%in%</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1952</span>, <span style="color:#099">2007</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">group_by</span>(continent, year) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">summarize</span>(media <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(lifeExp)) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">ungroup</span>()
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # A tibble: 10 x 3</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;    continent  year media</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;    &lt;fct&gt;     &lt;int&gt; &lt;dbl&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  1 Africa     1952  39.1</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  2 Africa     2007  54.8</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  3 Americas   1952  53.3</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  4 Americas   2007  73.6</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  5 Asia       1952  46.3</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  6 Asia       2007  70.7</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  7 Europe     1952  64.4</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  8 Europe     2007  77.6</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  9 Oceania    1952  69.3</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 10 Oceania    2007  80.7</span>
</span></span></code></pre></div><p>Casi, pero no!! Sólo hemos conseguido ver la esperanza de vida por continente en 1952 y 2007.En realidad esto ya lo hicimos antes. Falta restar.</p>
<p>Quizás podríamos calcular el máximo, el mínimo y restarlos. No, porque supondríamos que “lifeExp” siempre aumenta. Vamos que el tiempo apremia:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- primer intento: se puede hacer de una vez, pero vamos a partir el código en 2 trozos</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(year <span style="color:#000;font-weight:bold">%in%</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1952</span>, <span style="color:#099">2007</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">group_by</span>(continent, year) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">summarize</span>(media <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(lifeExp)) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">ungroup</span>() 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aa1 <span style="color:#000;font-weight:bold">&lt;-</span> aa <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">group_by</span>(continent) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">summarise</span>(min_l <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">min</span>(media), max_l <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">max</span>(media)) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">mutate</span>(dif <span style="color:#000;font-weight:bold">=</span> max_l<span style="color:#000;font-weight:bold">-</span>min_l) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">arrange</span>(<span style="color:#900;font-weight:bold">desc</span>(dif))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aa1
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # A tibble: 5 x 4</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   continent min_l max_l   dif</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   &lt;fct&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 1 Asia       46.3  70.7  24.4</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 2 Americas   53.3  73.6  20.3</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 3 Africa     39.1  54.8  15.7</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 4 Europe     64.4  77.6  13.2</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 5 Oceania    69.3  80.7  11.5</span>
</span></span></code></pre></div><p>Asia son los ganadores. En promedio, en Asía se mejoró la esperanza de vida en 24.4 años entre 1952 y 2007.</p>
<p>Lo de restar el máximo y el mínimo ha funcionado, PERO podría no haberlo hecho si hubiese habido algún continente en el que en la esperanza de vida, en lugar de haber aumentado, hubiese bajado. Entonces, ¿cómo lo hacemos?</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- segundo intento: se puede hacer de una vez, pero vamos a partir el código en 2 trozos</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(year <span style="color:#000;font-weight:bold">%in%</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1952</span>, <span style="color:#099">2007</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>  
</span></span><span style="display:flex;"><span>         <span style="color:#900;font-weight:bold">group_by</span>(continent, year) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>         <span style="color:#900;font-weight:bold">summarize</span>(media <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(lifeExp)) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">ungroup</span>() 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- usamos lag()</span>
</span></span><span style="display:flex;"><span>aa1 <span style="color:#000;font-weight:bold">&lt;-</span> aa <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">group_by</span>(continent) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>              <span style="color:#900;font-weight:bold">arrange</span>(year) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>              <span style="color:#900;font-weight:bold">mutate</span>(variac_l <span style="color:#000;font-weight:bold">=</span> media <span style="color:#000;font-weight:bold">-</span> <span style="color:#900;font-weight:bold">lag</span>(media))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- mostramos los resultados</span>
</span></span><span style="display:flex;"><span>aa1 <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(year <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">2007</span>) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">arrange</span>(<span style="color:#900;font-weight:bold">desc</span>(variac_l))
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # A tibble: 5 x 4</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # Groups:   continent [5]</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   continent  year media variac_l</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   &lt;fct&gt;     &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 1 Asia       2007  70.7     24.4</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 2 Americas   2007  73.6     20.3</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 3 Africa     2007  54.8     15.7</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 4 Europe     2007  77.6     13.2</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 5 Oceania    2007  80.7     11.5</span>
</span></span></code></pre></div><p>Sí, Asia es la ganadora. En promedio, en Asía se mejoró la esperanza de vida en 24 años entre 1952 y 2007.</p>
<p>Otra forma de obtener el mismo resultado:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- esta parte es común</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">filter</span>(year <span style="color:#000;font-weight:bold">%in%</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1952</span>, <span style="color:#099">2007</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">group_by</span>(continent, year) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">summarize</span>(media <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(lifeExp)) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">ungroup</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- pero ahora usamos pivot_wider()</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">pivot_wider</span>(names_from <span style="color:#000;font-weight:bold">=</span> year, values_from <span style="color:#000;font-weight:bold">=</span> media) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>     <span style="color:#900;font-weight:bold">mutate</span>(dif_l <span style="color:#000;font-weight:bold">=</span> `2007` <span style="color:#000;font-weight:bold">-</span> `1952`) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>     <span style="color:#900;font-weight:bold">arrange</span>(<span style="color:#900;font-weight:bold">desc</span>(dif_l))
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # A tibble: 5 x 4</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   continent `1952` `2007` dif_l</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 1 Asia        46.3   70.7  24.4</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 2 Americas    53.3   73.6  20.3</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 3 Africa      39.1   54.8  15.7</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 4 Europe      64.4   77.6  13.2</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 5 Oceania     69.3   80.7  11.5</span>
</span></span></code></pre></div><br>
<p>El chunk de abajo, ¿qué hace? ¿qué se está calculando?:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">group_by</span>(continent, year) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">select</span>(continent, year, lifeExp) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">summarise</span>(mean_life <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(lifeExp)) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">arrange</span>(year) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">mutate</span>(incre_mean_life_0 <span style="color:#000;font-weight:bold">=</span> mean_life <span style="color:#000;font-weight:bold">-</span> <span style="color:#900;font-weight:bold">first</span>(mean_life)) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">mutate</span>(incre_mean_life_t <span style="color:#000;font-weight:bold">=</span> mean_life <span style="color:#000;font-weight:bold">-</span> <span style="color:#900;font-weight:bold">lag</span>(mean_life)) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">arrange</span>(continent)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- por ejemplo veamos el resultado para Europe</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(continent <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;Europe&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # A tibble: 12 x 5</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # Groups:   continent [1]</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;    continent  year mean_life incre_mean_life_0 incre_mean_life_t</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;    &lt;fct&gt;     &lt;int&gt;     &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  1 Europe     1952      64.4              0               NA    </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  2 Europe     1957      66.7              2.29             2.29 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  3 Europe     1962      68.5              4.13             1.84 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  4 Europe     1967      69.7              5.33             1.20 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  5 Europe     1972      70.8              6.37             1.04 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  6 Europe     1977      71.9              7.53             1.16 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  7 Europe     1982      72.8              8.40             0.869</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  8 Europe     1987      73.6              9.23             0.836</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  9 Europe     1992      74.4             10.0              0.798</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 10 Europe     1997      75.5             11.1              1.07 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 11 Europe     2002      76.7             12.3              1.20 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 12 Europe     2007      77.6             13.2              0.948</span>
</span></span></code></pre></div><p>Sed conscientes de que la soluciones a una pregunta no sale a la primera, a veces hay que calentarse el cap:</p>
<blockquote>
<p>Break the code into pieces, starting at the top, and inspect the intermediate results. That’s certainly how I was able to write such a thing. These commands do not leap fully formed out of anyone’s forehead – they are built up gradually, with lots of errors and refinements along the way. Is the statement above really hard for you to read? If yes, then by all means break it into pieces and make some intermediate objects. Your code should be easy to write and read when you’re done. —- Jenny Bryan</p>
</blockquote>
<br>
<p>Otras cuestiones que podemos resolver con dplyr sobre la esperanza de vida:</p>
<ul>
<li>¿Cómo ha evolucionado la esperanza de vida en Spain lustro a lustro?</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- variación de lifeExp en Spain año a año (bueno lustro a lustro)</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">group_by</span>(country) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">select</span>(country, year, lifeExp) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">mutate</span>(lifeExp_gain_cada_lustro <span style="color:#000;font-weight:bold">=</span> lifeExp <span style="color:#000;font-weight:bold">-</span> <span style="color:#900;font-weight:bold">lag</span>(lifeExp)) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">filter</span>(country <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;Spain&#34;</span> )
</span></span><span style="display:flex;"><span>aa
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # A tibble: 12 x 4</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # Groups:   country [1]</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;    country  year lifeExp lifeExp_gain_cada_lustro</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;    &lt;fct&gt;   &lt;int&gt;   &lt;dbl&gt;                    &lt;dbl&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  1 Spain    1952    64.9                   NA    </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  2 Spain    1957    66.7                    1.72 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  3 Spain    1962    69.7                    3.03 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  4 Spain    1967    71.4                    1.75 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  5 Spain    1972    73.1                    1.62 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  6 Spain    1977    74.4                    1.33 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  7 Spain    1982    76.3                    1.91 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  8 Spain    1987    76.9                    0.600</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  9 Spain    1992    77.6                    0.670</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 10 Spain    1997    78.8                    1.20 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 11 Spain    2002    79.8                    1.01 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 12 Spain    2007    80.9                    1.16</span>
</span></span></code></pre></div><br>
<ul>
<li>¿Y la variación acumulada? Fácil!! Sólo tendríamos que sumar o acumular la variable “lifeExp_gain_cada_lustro” que hemos generado anteriormente, así que sólo habría que añadir una linea a nuestro código:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- ganancia acumulada</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">group_by</span>(country) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">select</span>(country, year, lifeExp) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">mutate</span>(lifeExp_gain_cada_lustro <span style="color:#000;font-weight:bold">=</span> lifeExp <span style="color:#000;font-weight:bold">-</span> <span style="color:#900;font-weight:bold">lag</span>(lifeExp)) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">#--- 2 filas nuevas: ifelse()  y cumsum()</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">mutate</span>(lifeExp_gain_cada_lustro2 <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">ifelse</span>(<span style="color:#900;font-weight:bold">is.na</span>(lifeExp_gain_cada_lustro), <span style="color:#099">0</span>, lifeExp_gain_cada_lustro)) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">mutate</span>(lifeExp_gain_acumulado <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">cumsum</span>(lifeExp_gain_cada_lustro2)) <span style="color:#000;font-weight:bold">%&gt;%</span>   
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">filter</span>(country <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;Spain&#34;</span>)
</span></span><span style="display:flex;"><span>aa
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # A tibble: 12 x 6</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # Groups:   country [1]</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;    country  year lifeExp lifeExp_gain_cada_lustro lifeExp_gain_cada_lu…¹ lifeE…²</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;    &lt;fct&gt;   &lt;int&gt;   &lt;dbl&gt;                    &lt;dbl&gt;                  &lt;dbl&gt;   &lt;dbl&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  1 Spain    1952    64.9                   NA                      0        0   </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  2 Spain    1957    66.7                    1.72                   1.72     1.72</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  3 Spain    1962    69.7                    3.03                   3.03     4.75</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  4 Spain    1967    71.4                    1.75                   1.75     6.5 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  5 Spain    1972    73.1                    1.62                   1.62     8.12</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  6 Spain    1977    74.4                    1.33                   1.33     9.45</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  7 Spain    1982    76.3                    1.91                   1.91    11.4 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  8 Spain    1987    76.9                    0.600                  0.600   12.0 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;  9 Spain    1992    77.6                    0.670                  0.670   12.6 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 10 Spain    1997    78.8                    1.20                   1.20    13.8 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 11 Spain    2002    79.8                    1.01                   1.01    14.8 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 12 Spain    2007    80.9                    1.16                   1.16    16.0 </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # … with abbreviated variable names ¹​lifeExp_gain_cada_lustro2,</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; #   ²​lifeExp_gain_acumulado</span>
</span></span></code></pre></div><p>Al final para hacerlo (como había pensado) me han hecho falta 2 lineas, porque la primera observación de “lifeExp_gain_cada_lustro” es un NA y eso hacía que la función <code>cumsum()</code> no funcionase.</p>
<br>
<ul>
<li>Otra forma de hacer lo mismo sería (se me ha ocurrido después). Además es más fácil</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- ganancia acumulada (otra forma de hacer lo mismo)</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">group_by</span>(country) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">select</span>(country, year, lifeExp) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">mutate</span>(lifeExp_gain_acumulada <span style="color:#000;font-weight:bold">=</span> lifeExp <span style="color:#000;font-weight:bold">-</span> lifeExp[1])  <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">filter</span>(country <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;Spain&#34;</span>)
</span></span></code></pre></div><br>
<ul>
<li>Obtener, para cada periodo, los (3) países de Asia con MAYOR lifeExp. Usaremos una variante de <code>slice()</code>, concrétamente <code>slice_max()</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">filter</span>(continent <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;Asia&#34;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">select</span>(year, country, lifeExp) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">group_by</span>(year) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">slice_max</span>(n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>, lifeExp) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">arrange</span>(year) 
</span></span></code></pre></div><p>Para obtener los 4 países con <strong>MENOR</strong> “lifeExp” sólo tendríamos que sustituir la quinta linea por <code>slice_min(n = 4, lifeExp)</code></p>
<br>
<ul>
<li>Obtener, para cada periodo, los países de Asia con mayor y menor lifeExp.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- Obtener, para cada periodo, los países de Asia con mayor y menor lifeExp.</span>
</span></span><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">filter</span>(continent <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;Asia&#34;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">select</span>(year, continent, country, lifeExp) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">group_by</span>(year) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">filter</span>(<span style="color:#900;font-weight:bold">min_rank</span>(<span style="color:#900;font-weight:bold">desc</span>(lifeExp)) <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">|</span> <span style="color:#900;font-weight:bold">min_rank</span>(lifeExp) <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">2</span>) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">arrange</span>(year) 
</span></span></code></pre></div><p>Las 2 últimas funciones que hemos usado: <code>slice_min()</code> y <code>min_rank()</code> son funciones de dplyr pero no son son funciones principales, en cierta forma son auxiliares.</p>
<br>
<p>Podéis ver las funciones auxiliares que tiene dplyr en la segunda página de 
<a href="https://www.rstudio.com/resources/cheatsheets/" target="_blank" rel="noopener">CHEAT SHEET</a>. también se pueden usar las funciones de R-base o de otros packages. Aquí tenéis algunas posibilidades sacadas de un 
<a href="https://www.dropbox.com/sh/i8qnluwmuieicxc/AAAgt9tIKoIm7WZKIyK25lh6a?preview=dplyr-tutorial.pdf" target="_blank" rel="noopener">tutorial de Hadley</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>Types of summary functions<span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>• <span style="color:#900;font-weight:bold">min</span>(x), <span style="color:#900;font-weight:bold">median</span>(x), <span style="color:#900;font-weight:bold">max</span>(x), <span style="color:#900;font-weight:bold">quantile</span>(x, p) 
</span></span><span style="display:flex;"><span>• <span style="color:#900;font-weight:bold">n</span>(), <span style="color:#900;font-weight:bold">n_distinct</span>(), <span style="color:#900;font-weight:bold">sum</span>(x), <span style="color:#900;font-weight:bold">mean</span>(x) 
</span></span><span style="display:flex;"><span>• <span style="color:#900;font-weight:bold">sum</span>(x <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">10</span>), <span style="color:#900;font-weight:bold">mean</span>(x <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">10</span>) 
</span></span><span style="display:flex;"><span>• <span style="color:#900;font-weight:bold">sd</span>(x), <span style="color:#900;font-weight:bold">var</span>(x), <span style="color:#900;font-weight:bold">iqr</span>(x), <span style="color:#900;font-weight:bold">mad</span>(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Types of window functions<span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>• Ranking and ordering 
</span></span><span style="display:flex;"><span>• Offsets<span style="color:#000;font-weight:bold">:</span> lead <span style="color:#000;font-weight:bold">&amp;</span> lag 
</span></span><span style="display:flex;"><span>• Cumulative aggregates
</span></span><span style="display:flex;"><span>• Rolling aggregates
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Ejemplos<span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>• Was there a change<span style="color:#000;font-weight:bold">?</span>  x <span style="color:#000;font-weight:bold">!=</span> <span style="color:#900;font-weight:bold">lag</span>(x)
</span></span><span style="display:flex;"><span>• Percent change<span style="color:#000;font-weight:bold">?</span> (x <span style="color:#000;font-weight:bold">-</span> <span style="color:#900;font-weight:bold">lag</span>(x)) <span style="color:#000;font-weight:bold">/</span> x
</span></span><span style="display:flex;"><span>• Fold<span style="color:#000;font-weight:bold">-</span>change<span style="color:#000;font-weight:bold">?</span> x <span style="color:#000;font-weight:bold">/</span> <span style="color:#900;font-weight:bold">lag</span>(x)
</span></span><span style="display:flex;"><span>• Previously false, now true<span style="color:#000;font-weight:bold">?</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#900;font-weight:bold">lag</span>(x) <span style="color:#000;font-weight:bold">&amp;</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>• If one of the specialised verbs doesn’t do what you need, you can use <span style="color:#900;font-weight:bold">do</span>()
</span></span></code></pre></div><br>




<h5 id="a-ver-si-entendeis-este-ejemplo">A ver si entendeis este ejemplo
  <a href="#a-ver-si-entendeis-este-ejemplo"></a>
</h5>
<p>Una <strong>función auxiliar</strong> que es <strong>muy útil</strong> al utilizarla junto a mutate: <code>case_when()</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>aa <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">group_by</span>(continent, year)  <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">mutate</span>(media_lifeExp <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(lifeExp)) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">mutate</span>(media_gdpPercap <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(gdpPercap)) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">mutate</span>(GOOD_or_BAD <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">case_when</span>( 
</span></span><span style="display:flex;"><span>    lifeExp <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">mean</span>(lifeExp) <span style="color:#000;font-weight:bold">&amp;</span> gdpPercap <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">mean</span>(gdpPercap)  <span style="color:#000;font-weight:bold">~</span> <span style="color:#d14">&#34;good&#34;</span>,
</span></span><span style="display:flex;"><span>    lifeExp <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#900;font-weight:bold">mean</span>(lifeExp) <span style="color:#000;font-weight:bold">&amp;</span> gdpPercap <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#900;font-weight:bold">mean</span>(gdpPercap)  <span style="color:#000;font-weight:bold">~</span> <span style="color:#d14">&#34;bad&#34;</span> ,
</span></span><span style="display:flex;"><span>    lifeExp <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#900;font-weight:bold">mean</span>(lifeExp) <span style="color:#000;font-weight:bold">|</span> gdpPercap <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#900;font-weight:bold">mean</span>(gdpPercap)  <span style="color:#000;font-weight:bold">~</span> <span style="color:#d14">&#34;medium&#34;</span>
</span></span><span style="display:flex;"><span>    )) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">filter</span>(country <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;Spain&#34;</span>)
</span></span></code></pre></div><br>




<h5 id="más-funciones-auxiliares">Más funciones auxiliares
  <a href="#m%c3%a1s-funciones-auxiliares"></a>
</h5>
<p>Hay algunas que no quiero olvidar:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>dplyr<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">ntile</span>(x, n) <span style="color:#000;font-weight:bold">:</span> categorizes a vector of values into <span style="color:#d14">&#34;ntiles&#34;</span> such as quartiles if n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dplyr<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">n_distinct</span>(x)<span style="color:#000;font-weight:bold">:</span>  counts unique values in a vector; similar a  <span style="color:#900;font-weight:bold">length</span>(<span style="color:#900;font-weight:bold">unique</span>(x))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dplyr<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">between</span>(x, left, right) <span style="color:#000;font-weight:bold">:</span> is a shortcut for x <span style="color:#000;font-weight:bold">&gt;=</span> left <span style="color:#000;font-weight:bold">&amp;</span> x <span style="color:#000;font-weight:bold">&lt;=</span> right, 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tibble<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">add_row</span>()  <span style="color:#000;font-weight:bold">:</span> añade rows a un df
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tibble<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">rownames_to_column</span>()
</span></span></code></pre></div><br>




<h2 id="más-detalles-sobre-dplyr">Más detalles sobre dplyr
  <a href="#m%c3%a1s-detalles-sobre-dplyr"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Los verbos <code>mutate()</code> y <code>summarise()</code> ya sabemos que pueden hacer uso de funciones como <code>mean()</code>, <code>sd()</code> etc … Por ejemplo podemos transformar las variables numéricas a logaritmos:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#900;font-weight:bold">where</span>(is.numeric), log)) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">head</span>(n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>)
</span></span></code></pre></div><p>Se pueden usar tidy_helpers para seleccionar las columnas y aplicar más de una función:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">starts_with</span>(<span style="color:#d14">&#34;life&#34;</span>), <span style="color:#900;font-weight:bold">contains</span>(<span style="color:#d14">&#34;po&#34;</span>)), .fns <span style="color:#000;font-weight:bold">=</span>  mean)) <span style="color:#000;font-weight:bold">%&gt;%</span> head
</span></span></code></pre></div><p>o calcular la media de las variable numéricas y controlar el nombre de las variables creadas:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">group_by</span>(continent) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">summarize</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#900;font-weight:bold">where</span>(is.numeric), mean, .names <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;mean_{col}&#34;</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">head</span>(n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>)
</span></span></code></pre></div><p>Si quieres seleccionar todas las variables usa <code>everything()</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">group_by</span>(continent) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">summarize</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#900;font-weight:bold">everything</span>(), as.character, .names <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;CHAR_{col}&#34;</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">head</span>(n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>)
</span></span></code></pre></div><p>Pero vamos a ver otras posibilidades:</p>
<br>




<h3 id="más-de-una-condición-para-seleccionar-las-columnas">más de una condición para seleccionar las columnas:
  <a href="#m%c3%a1s-de-una-condici%c3%b3n-para-seleccionar-las-columnas"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#900;font-weight:bold">where</span>(is.double) <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#900;font-weight:bold">ends_with</span>(<span style="color:#d14">&#34;cap&#34;</span>), as.integer)) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">head</span>(n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>)
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # A tibble: 3 x 6</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   country     continent  year lifeExp      pop gdpPercap</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;int&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 1 Afghanistan Asia       1952    28.8  8425333       779</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 2 Afghanistan Asia       1957    30.3  9240934       820</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 3 Afghanistan Asia       1962    32.0 10267083       853</span>
</span></span></code></pre></div><br>




<h3 id="uso-de-funciones-propias-">uso de funciones propias (!!!!)
  <a href="#uso-de-funciones-propias-"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Tenemos varias posibilidades:</p>
<ul>
<li>
<ol>
<li>definiendo primero la función:</li>
</ol>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>dividir_100 <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">function</span>(x) {x <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">100</span>}  <span style="color:#998;font-style:italic">#- defino una función</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#900;font-weight:bold">where</span>(is.numeric), .fns <span style="color:#000;font-weight:bold">=</span> dividir_100)) <span style="color:#000;font-weight:bold">%&gt;%</span> head
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # A tibble: 6 x 6</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   country     continent  year lifeExp     pop gdpPercap</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 1 Afghanistan Asia       19.5   0.288  84253.      7.79</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 2 Afghanistan Asia       19.6   0.303  92409.      8.21</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 3 Afghanistan Asia       19.6   0.320 102671.      8.53</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 4 Afghanistan Asia       19.7   0.340 115380.      8.36</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 5 Afghanistan Asia       19.7   0.361 130795.      7.40</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 6 Afghanistan Asia       19.8   0.384 148804.      7.86</span>
</span></span></code></pre></div><ul>
<li>
<ol start="2">
<li>usando formulas anónimas</li>
</ol>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#900;font-weight:bold">where</span>(is.numeric), .fns <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">function</span>(x) {x <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">100</span>})) <span style="color:#000;font-weight:bold">%&gt;%</span> head
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # A tibble: 6 x 6</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   country     continent  year lifeExp     pop gdpPercap</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 1 Afghanistan Asia       19.5   0.288  84253.      7.79</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 2 Afghanistan Asia       19.6   0.303  92409.      8.21</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 3 Afghanistan Asia       19.6   0.320 102671.      8.53</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 4 Afghanistan Asia       19.7   0.340 115380.      8.36</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 5 Afghanistan Asia       19.7   0.361 130795.      7.40</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 6 Afghanistan Asia       19.8   0.384 148804.      7.86</span>
</span></span></code></pre></div><ul>
<li>
<ol start="3">
<li>usando fórmulas</li>
</ol>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- con formulas</span>
</span></span><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#900;font-weight:bold">where</span>(is.numeric), .fns <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">~</span> .x<span style="color:#000;font-weight:bold">/</span><span style="color:#099">100</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span> head
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # A tibble: 6 x 6</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   country     continent  year lifeExp     pop gdpPercap</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 1 Afghanistan Asia       19.5   0.288  84253.      7.79</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 2 Afghanistan Asia       19.6   0.303  92409.      8.21</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 3 Afghanistan Asia       19.6   0.320 102671.      8.53</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 4 Afghanistan Asia       19.7   0.340 115380.      8.36</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 5 Afghanistan Asia       19.7   0.361 130795.      7.40</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 6 Afghanistan Asia       19.8   0.384 148804.      7.86</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#900;font-weight:bold">where</span>(is.numeric), .fns <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">~</span> {<span style="color:#099">1</span><span style="color:#000;font-weight:bold">/</span><span style="color:#900;font-weight:bold">sqrt</span>(.)})) <span style="color:#000;font-weight:bold">%&gt;%</span> head
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; # A tibble: 6 x 6</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   country     continent   year lifeExp      pop gdpPercap</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt;   &lt;fct&gt;       &lt;fct&gt;      &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 1 Afghanistan Asia      0.0226   0.186 0.000345    0.0358</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 2 Afghanistan Asia      0.0226   0.182 0.000329    0.0349</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 3 Afghanistan Asia      0.0226   0.177 0.000312    0.0342</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 4 Afghanistan Asia      0.0225   0.171 0.000294    0.0346</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 5 Afghanistan Asia      0.0225   0.166 0.000277    0.0368</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; 6 Afghanistan Asia      0.0225   0.161 0.000259    0.0357</span>
</span></span></code></pre></div><p>usar formulas facilita el uso de argumentos dentro de la función:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">group_by</span>(continent, year) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">across</span>(<span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;lifeExp&#34;</span>, <span style="color:#d14">&#34;gdpPercap&#34;</span>), 
</span></span><span style="display:flex;"><span>				   <span style="color:#900;font-weight:bold">list</span>(mean <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">~</span> <span style="color:#900;font-weight:bold">mean</span>(.x, na.rm <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">TRUE</span>, trim <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.1</span>))))
</span></span></code></pre></div>



<h3 id="crear-indices-de-grupo">crear indices de grupo
  <a href="#crear-indices-de-grupo"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>A veces cuando trabajas con df agrupados es útil saber a que grupo pertenece cada observación. Puedes hacerlo fácilmente con:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">group_by</span>(year)  <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(id_grupo <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">cur_group_id</span>()) 
</span></span></code></pre></div><p><br><br></p>
<hr>




<h1 id="5-combinando-joining-dfs">5. Combinando (joining) df’s
  <a href="#5-combinando-joining-dfs"></a>
</h1>
<br>
<p>OK, ya sabemos manejar/filtrar etc… un conjunto de datos, PERO muchas veces lo que hay que hacer es unir o <strong>combinar varias tablas</strong> o conjuntos de datos (Joinings en inglés).</p>
<p>Vamos a aprender como hacerlo usando dplyr. [
<a href="https://cran.r-project.org/web/packages/dplyr/vignettes/two-table.html" target="_blank" rel="noopener">Aquí</a>] tenéis la vignette de dplyr para “two table verbs”, también podéis ver un vídeo muy ilustrativo [
<a href="https://www.youtube.com/watch?v=QHXpsMSDszg" target="_blank" rel="noopener">aquí</a>]. También podéis usar el 
<a href="http://stat545.com/bit001_dplyr-cheatsheet.html" target="_blank" rel="noopener">tutorial de Jenny</a>. La 
<a href="https://www.rstudio.com/resources/cheatsheets/" target="_blank" rel="noopener">CHEAT SHEET</a> es muy-muy buena.</p>
<p>Los ejemplos e imágenes usados en esta sección se basan en los creados por 
<a href="https://twitter.com/dataandme?lang=es" target="_blank" rel="noopener">Mara Averick (@dataandme)</a> en 
<a href="https://github.com/batpigandme/tidyexplain/tree/pivot" target="_blank" rel="noopener">este repo</a>, que a su vez se basaron en la idea de 
<a href="https://twitter.com/grrrck" target="_blank" rel="noopener">Garrick Aden-Buie @grrrck</a></p>
<br>




<h2 id="dos-casos-sencillos">(dos) casos sencillos
  <a href="#dos-casos-sencillos"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>




<h4 id="dos-casos-ideales-sencillos-de-unir-bind_cols-y-bind_rows">Dos casos ideales (sencillos de unir): <code>bind_cols()</code> y <code>bind_rows()</code>
  <a href="#dos-casos-ideales-sencillos-de-unir-bind_cols-y-bind_rows"></a>
</h4>
<ol>
<li>Si los 2 dfs tienen <strong>exactamente las mismas filas</strong> o unidades de análisis ( y ademas en el mismo orden). En este caso, solo habría que juntar en una misma tabla las columnas de df1 y de df2. Esto lo podemos hacer con <code>bind_cols()</code> (o con <strong>c</strong>bind() de R-base).</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>df_1 <span style="color:#000;font-weight:bold">&lt;-</span> iris[ , <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">2</span>]  ; df_2 <span style="color:#000;font-weight:bold">&lt;-</span> iris[ , <span style="color:#099">3</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">5</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df_1 <span style="color:#000;font-weight:bold">&lt;-</span> iris <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">2</span>)  ; df_2 <span style="color:#000;font-weight:bold">&lt;-</span> iris <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(<span style="color:#099">3</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">5</span>) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df_3 <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">`bind_cols`</span>(df_1, df_2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">identical</span>(iris, df_3)
</span></span></code></pre></div><ol start="2">
<li>Si los 2 dfs tienen <strong>exactamente las mismas columnas</strong> ( y ademas en el mismo orden). En este caso, se trataría simplemente de juntar todas las observaciones o filas de los 2 df’s. Esto lo podemos hacer con <code>bind_rows()</code> (o con <strong>r</strong>bind() de R-base)</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>df_1 <span style="color:#000;font-weight:bold">&lt;-</span> iris[1<span style="color:#000;font-weight:bold">:</span><span style="color:#099">75</span>, ]  ; df_2 <span style="color:#000;font-weight:bold">&lt;-</span> iris[76<span style="color:#000;font-weight:bold">:</span><span style="color:#099">150</span>, ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df_1 <span style="color:#000;font-weight:bold">&lt;-</span> iris <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">slice</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">75</span>)  ; df_2 <span style="color:#000;font-weight:bold">&lt;-</span> iris <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">slice</span>(<span style="color:#099">76</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">150</span>) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df_3 <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">`bind_rows`</span>(df_1, df_2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">identical</span>(iris, df_3)
</span></span></code></pre></div><br>




<h4 id="olvidando-ya-los-2-casos-ideales-y-sencillos">Olvidando ya los 2 casos ideales y sencillos
  <a href="#olvidando-ya-los-2-casos-ideales-y-sencillos"></a>
</h4>
<br>
<p>En dplyr hay 3 tipos de funciones(verbos) que se ocupan de diferentes operaciones para unir datasets:</p>
<ul>
<li>
<p><strong>Mutating joins</strong>, añade nuevas variables (o columnas) a un dataframe (df1). Estas nuevas columnas vienen de un segundo df2 (hay varias mutating joins, dependiendo del criterio para seleccionar las filas)</p>
</li>
<li>
<p><strong>Filtering joins</strong>, filtra las filas (observaciones) de un dataframe (df1) basándose en sí las filas de df1 coinciden (match) o no con una observación del segundo df2</p>
</li>
<li>
<p><strong>Set operations</strong>, combina las observaciones de los dos datasets (df1 y df2) as if they were set elements.</p>
</li>
</ul>
<br>
<p>Todas estas funciones tienen una <strong>estructura similar</strong>: sus dos primeros argumentos son 2 df’s (en realidad tablas de datos): df1 y df2. El output de la función es siempre una nueva tabla (del mismo tipo que df1).</p>
<br>
<hr>




<h2 id="mutating-joins">Mutating joins
  <a href="#mutating-joins"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Hay <strong>4 tipos de mutating joins</strong>. Su sintaxis es idéntica, sólo se diferencian en que las filas que se seleccionan dependen del criterio para hacer el match:</p>
<ul>
<li>
<p><code>inner_join(df1,df2)</code>: Retorna todas las columnas de df1 y también las de df2, PERO <strong>solo retorna las filas de df1 que tienen una equivalencia en df2</strong>. (la equivalencia se define en función del valor de una variable o variables comunes en df1 y df2)</p>
</li>
<li>
<p><code>left_join(df1,df2)</code>: Retorna todas las columnas de df1 y también las de df2; en cuanto a las filas, <strong>retorna TODAS las filas de df1</strong>. (Si hubiesen varios matches entre df1 e df2 se retornan todas las combinaciones!!!!)</p>
</li>
<li>
<p><code>rigth_join(df1,df2)</code>: Retorna todas las columnas de df1 y también las de df2; en cuanto a las filas, <strong>retorna TODAS las filas de df2</strong>. De <strong>df2</strong>!! (Si hubiesen varios matches entre df1 y df2 se retornan todas las combinaciones!!!!)</p>
</li>
<li>
<p><code>full_join(df1,df2)</code>: Retorna todas las columnas de df1 y también las de df2; en cuanto a las filas, <strong>retorna TODAS las filas de df1 y de df2</strong>. Osea, retorna TODAS las filas y TODAS las columnas de las 2 tablas. (Donde no hay matches retorna NA’s)</p>
</li>
</ul>
<br>




<h4 id="ejemplos-de-mutating-joins">Ejemplos de mutating joins
  <a href="#ejemplos-de-mutating-joins"></a>
</h4>
<p>Sean los siguientes 2 dataframes (tibbles):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>x <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">tibble</span>(id <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">3</span>, x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">paste0</span>(<span style="color:#d14">&#34;x&#34;</span>, <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">3</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>y <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">tibble</span>(id <span style="color:#000;font-weight:bold">=</span> (<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">4</span>)[<span style="color:#099">-3</span>], y <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">paste0</span>(<span style="color:#d14">&#34;y&#34;</span>, (<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">4</span>)[<span style="color:#099">-3</span>]))
</span></span></code></pre></div><br>




<h5 id="inner-join">Inner Join
  <a href="#inner-join"></a>
</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- only includes observations that match in both x and y</span>
</span></span><span style="display:flex;"><span>df_inner <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">inner_join</span>(x, y)
</span></span></code></pre></div><br>




<h5 id="left-join">Left Join
  <a href="#left-join"></a>
</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- includes all observations in x, regardless of whether they match or not. </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- This is the most commonly used join because it ensures that you don’t lose observations from your primary table.</span>
</span></span><span style="display:flex;"><span>df_left_join <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">left_join</span>(x, y)
</span></span></code></pre></div><br>




<h5 id="right-joint">Right Joint
  <a href="#right-joint"></a>
</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- includes all observations in y. </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- It’s equivalent to left_join(y, x), but the columns will be ordered differently.</span>
</span></span><span style="display:flex;"><span>df_right_join <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">right_join</span>(x, y)
</span></span></code></pre></div><br>




<h5 id="full-joint">Full Joint
  <a href="#full-joint"></a>
</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- full_join() includes all observations from x and y</span>
</span></span><span style="display:flex;"><span>df_full_join <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">full_join</span>(x, y)
</span></span></code></pre></div><br>




<h5 id="2-precisiones-sobre-las-mutating-joins">2 precisiones sobre las mutating joins
  <a href="#2-precisiones-sobre-las-mutating-joins"></a>
</h5>
<p>Las (left, right and full) joins se llaman colectivamente como “outer joins”. Cuando una fila no tiene match en una outer join, las nuevas variables que se crean se llenan con NA’s.</p>
<p>Las mutating joins se usan principalmente para añadir columnas, <strong>PERO</strong> en el proceso pueden generarse nuevas filas: si un match no es único, se añadirán todas las combinaciones posibles (el producto cartesiano) de las matching observations. Veamos un ejemplo con una left_join:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>x <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">tibble</span>(id <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">3</span>, x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">paste0</span>(<span style="color:#d14">&#34;x&#34;</span>, <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">3</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>y <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">tibble</span>(id <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">4</span>,<span style="color:#099">2</span>)[<span style="color:#099">-3</span>], y <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">paste0</span>(<span style="color:#d14">&#34;y&#34;</span>, <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">5</span>)[<span style="color:#099">-3</span>]))
</span></span></code></pre></div><br>




<h5 id="left_join-en-la-que-se-crean-nuevas-filas">left_join() en la que se crean nuevas filas
  <a href="#left_join-en-la-que-se-crean-nuevas-filas"></a>
</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>df_left_join <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">left_join</span>(x, y)
</span></span></code></pre></div><br>




<h4 id="importante-cómo-decir-a-las-funciones-la-columnas-o-columnas-que-se-usarán-para-hacer-los-matching">Importante ¿Cómo decir a las funciones la columnas (o columnas) que se usarán para hacer los matching?
  <a href="#importante-c%c3%b3mo-decir-a-las-funciones-la-columnas-o-columnas-que-se-usar%c3%a1n-para-hacer-los-matching"></a>
</h4>
<p>Podemos(DEBEMOS) elegir las columnas (o variables) que nos servirán para unir los 2 df’s. Estas columnas que se usan para para hallar los matchings y que por tanto nos permiten fusionar los 2 df’s se llaman “keys”.</p>
<p>La opción de las funciones para seleccionar estas columnas “keys” es <code>by =</code>.</p>
<ul>
<li>
<p>si ponemos <code>left_join(df1, df2, by = &quot;X1&quot;)</code> se hará una left_join siendo la variable “X1” la que hará de key. Si las variables key no se llamasen igual en los 2 df’s siempre podemos renombrarlas o hacer lo siguiente: <code>left_join(df1, df2, by = c(&quot;X1&quot; = &quot;D4&quot;)</code></p>
</li>
<li>
<p>También se pueden fusionar tablas usando dos keys; por ejemplo: <code>left_join(df1, df2, by = c(&quot;X1&quot;, &quot;X2&quot;))</code> . Si no se llamasen igual las variables en df1 y df2 haríamos <code>left_join(df1, df2, by = c(&quot;X1&quot; = &quot;D4&quot;, &quot;X2&quot; = &quot;D7&quot;))</code></p>
</li>
</ul>
<br>
<br>
<hr>




<h2 id="filtering-joins">Filtering joins
  <a href="#filtering-joins"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Filtering joins son similares a los anteriores (Mutating joins); o sea, hacen machting con las filas de la misma manera, <strong>PERO afectan a las filas</strong>, NO a las columnas. Hay filtering joins de 2 tipos:</p>
<ul>
<li><code>semi_join(df1,df2)</code>: retorna las observaciones de df1 que tienen un match en df2. En cuanto a las columnas sólo retorna las columnas de df1</li>
<li><code>anti_join(df1,df2)</code>: retorna las observaciones de df1 que NO tienen un match en df2; osea, quita las observaciones con match. En cuanto a las columnas sólo retorna las columnas de df1</li>
</ul>
<p>La semi_join se diferencia de la inner_join en que la inner_join solo retorna una fila de df1 por cada matching, mientras que <strong>la semi_join NUNCA duplica filas de df1</strong></p>
<p>Las filtering joins son útiles para diagnosticar mismatches.
Si quieres saber sobre los matches, haz una semi_join() or anti_join(). semi_join() and anti_join() NUNCA duplican filas; solo pueden quitar filas.</p>
<br>




<h5 id="semi_join">semi_join
  <a href="#semi_join"></a>
</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>df_semi_join <span style="color:#000;font-weight:bold">&lt;-</span>  <span style="color:#900;font-weight:bold">semi_join</span>(x, y, by <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;id&#34;</span>)
</span></span></code></pre></div><br>




<h5 id="anti_join">anti_join
  <a href="#anti_join"></a>
</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>df_anti_join <span style="color:#000;font-weight:bold">&lt;-</span>  <span style="color:#900;font-weight:bold">anti_join</span>(x, y, by <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;id&#34;</span>)
</span></span></code></pre></div><br>




<h5 id="comparemos-la-semi_join-con-la-inner_join">comparemos la semi_join con la inner_join
  <a href="#comparemos-la-semi_join-con-la-inner_join"></a>
</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>df_inner <span style="color:#000;font-weight:bold">&lt;-</span>  <span style="color:#900;font-weight:bold">inner_join</span>(x, y, by <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;id&#34;</span>)
</span></span><span style="display:flex;"><span>df_semi_join <span style="color:#000;font-weight:bold">&lt;-</span>  <span style="color:#900;font-weight:bold">semi_join</span>(x, y, by <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;id&#34;</span>)
</span></span></code></pre></div><p>La inner_join</p>
<ul>
<li>
<ol>
<li>añade variables del data.frame y al data.frame x (en este caso y$y)</li>
</ol>
</li>
<li>
<ol start="2">
<li>sólo retiene las rows del data.frame x <strong>que tienen un match en y</strong> (en este caso las 2 primeras filas de x)</li>
</ol>
</li>
<li>
<ol start="3">
<li>PERO <strong>en este ejemplo ADEMÁS</strong> duplica rows. la razón es que hay matching duplicados, hay 2 unos en x y otros 2 unos en el data.frame y (con distintos valores de y$y) (así que salen 4 rows)</li>
</ol>
</li>
</ul>
<br>




<h4 id="importante-cómo-decir-a-las-funciones-la-columna-o-columnas-que-se-usarán-para-hacer-los-matching">Importante ¿Cómo decir a las funciones la columna, o columnas, que se usarán para hacer los matching?
  <a href="#importante-c%c3%b3mo-decir-a-las-funciones-la-columna-o-columnas-que-se-usar%c3%a1n-para-hacer-los-matching"></a>
</h4>
<p>Al igual que con las mutating joins, en las filtering joins también podemos(DEBEMOS) elegir las columnas (o variables) que nos servirán para unir los 2 df’s. Estas columnas que se usan para para hallar los matchings y que por tanto que permiten fusionar los 2 df’s se llaman “keys”.</p>
<p>La opción de las funciones para seleccionar estas columnas “keys” es <code>by =</code>.</p>
<ul>
<li>
<p>si ponemos <code>semi_join(df1, df2, by = &quot;X1&quot;)</code> se hará una semi_join siendo la variable “X1” la que hará de key. Si las variables key no se llamasen igual en los 2 df’s siempre podemos renombrarlas o hacer <code>semi_join(df1, df2, by = c(&quot;X1&quot; = &quot;D4&quot;)</code></p>
</li>
<li>
<p>si ponemos <code>semi_join(df1, df2,by = c(&quot;X1&quot;, &quot;X2&quot;)</code> hará falta que una row de df1 tenga los valores tanto de X1 como de X2 iguales a los de esas mismas variables en df2. Si no se llamasen igual las variables en df1 y df2 haríamos <code>by = c(&quot;X1&quot; = &quot;D4&quot;, &quot;X2&quot; = &quot;D7&quot;)</code></p>
</li>
</ul>
<hr>
<br>




<h2 id="set-operations">Set operations
  <a href="#set-operations"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Este tipo de joins es más estricta: <strong>hace falta que los 2 df’s tengan las mismas variables (o columnas)</strong>. Los 2 df’s pueden tener observaciones(filas) diferentes, PERO es necesario que tengan las mismas variables (o columnas).</p>
<p>Como los 2 df’s tienen las mismas columnas, entonces es como si se tratasen los dfs como conjuntos:</p>
<ul>
<li><code>intersect(df1, df2)</code>: devuelve un df con las observaciones comunes en df1 y df2</li>
<li><code>union(df1, df2)</code>: devuelve la unión; o sea, las observaciones de df1 y de df2 (quitando las posibles filas duplicadas)</li>
<li><code>union_all(df1, df2)</code>: devuelve la unión (sin quitar los duplicados)</li>
<li><code>setdiff(df1, df2)</code>: devuelve las filas en df1 que no están en df2</li>
</ul>
<br>
<ul>
<li><code>setequal(df1,df2</code>: retorna TRUE si df y df2 tienen exactamente las mismas filas (da igual el orden en el que estén las filas)</li>
</ul>
<br>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>x <span style="color:#000;font-weight:bold">&lt;-</span> tibble<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">tibble</span>(v1 <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">2</span>), v2 <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;a&#34;</span> , <span style="color:#d14">&#34;b&#34;</span>, <span style="color:#d14">&#34;a&#34;</span>))
</span></span><span style="display:flex;"><span>y <span style="color:#000;font-weight:bold">&lt;-</span> tibble<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">tibble</span>(v1 <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span>, <span style="color:#099">2</span>),    v2 <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;a&#34;</span> , <span style="color:#d14">&#34;b&#34;</span>))
</span></span></code></pre></div><br>




<h5 id="intersección">intersección
  <a href="#intersecci%c3%b3n"></a>
</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">intersect</span>(x, y)
</span></span></code></pre></div><br>




<h5 id="unión">unión
  <a href="#uni%c3%b3n"></a>
</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">union</span>(x, y)
</span></span></code></pre></div><br>




<h5 id="setdiff">setdiff
  <a href="#setdiff"></a>
</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">setdiff</span>(x, y)
</span></span></code></pre></div><p>Puedes probar tú mismo a cambiar el orden del los df’s en <code>setdiff()</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">setdiff</span>(y, x)
</span></span></code></pre></div><br>




<h5 id="setqual">setqual
  <a href="#setqual"></a>
</h5>
<p>Sirve para determinar si 2 df’s son iguales (sin importar el orden en que estén las filas)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">setequal</span>(x, y)
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; [1] FALSE</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">setequal</span>(<span style="color:#900;font-weight:bold">union</span>(x, y), <span style="color:#900;font-weight:bold">union</span>(y, x))
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; [1] TRUE</span>
</span></span></code></pre></div><br>
<hr>
<br>




<h1 id="esperando-a-godotggplot2">Esperando a GODOT/ggplot2
  <a href="#esperando-a-godotggplot2"></a>
</h1>
<br>
<p>Bueno, pues hemos visto “TODO” sobre manipulación de datos. El próximo tutorial va de visualización: hacia ggplot2</p>
<p>Aquí un pequeño avance:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(<span style="color:#d14">&#34;ggplot2&#34;</span>)
</span></span><span style="display:flex;"><span>my_plot <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">ggplot</span>(gapminder, <span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> continent, y <span style="color:#000;font-weight:bold">=</span> lifeExp)) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_boxplot</span>(outlier.colour <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;hotpink&#34;</span>) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_jitter</span>(position <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">position_jitter</span>(width <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.1</span>, height <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>), alpha <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span><span style="color:#000;font-weight:bold">/</span><span style="color:#099">4</span>) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">labs</span>(title <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Experanza de vida (por continente)&#34;</span>,
</span></span><span style="display:flex;"><span>       subtitle <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Datos de gapminder. 1952-2007(observaciones cada 5 años)&#34;</span>,
</span></span><span style="display:flex;"><span>       caption <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Source: Gapminder. Jenny Bryan rocks in gapminder vignette!!&#34;</span>, 
</span></span><span style="display:flex;"><span>       x <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Continente&#34;</span>, y <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Esperanza de Vida (lifeExp)&#34;</span>) 
</span></span></code></pre></div><br>
<img src="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-5-data-munging-manejo-de-datos-con-r-the-tidyverse-way/index_files/figure-html/unnamed-chunk-124-1.png" width="60%" style="display: block; margin: auto;" />
<br>
<br>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>gapminder2 <span style="color:#000;font-weight:bold">&lt;-</span> gapminder <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">mutate</span>(year <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">as.factor</span>(year))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(<span style="color:#d14">&#34;ggplot2&#34;</span>)
</span></span><span style="display:flex;"><span>my_plot <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">ggplot</span>(gapminder2, <span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> year, y <span style="color:#000;font-weight:bold">=</span> lifeExp)) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_boxplot</span>(outlier.colour <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;hotpink&#34;</span>) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_jitter</span>(position <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">position_jitter</span>(width <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.1</span>, height <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>), alpha <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span><span style="color:#000;font-weight:bold">/</span><span style="color:#099">4</span>) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">labs</span>(title <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Experanza de vida (por año)&#34;</span>,
</span></span><span style="display:flex;"><span>       subtitle <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Datos de gapminder. 1952-2007(observaciones cada 5 años)&#34;</span>,
</span></span><span style="display:flex;"><span>       caption <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Source: Gapminder. Jenny Bryan rocks in gapminder vignette!!&#34;</span>, 
</span></span><span style="display:flex;"><span>       x <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Periodo&#34;</span>, y <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Esperanza de Vida (lifeExp)&#34;</span>) 
</span></span></code></pre></div><br>
<img src="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-5-data-munging-manejo-de-datos-con-r-the-tidyverse-way/index_files/figure-html/unnamed-chunk-126-1.png" width="60%" style="display: block; margin: auto;" />
<br>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(<span style="color:#d14">&#34;ggplot2&#34;</span>)
</span></span><span style="display:flex;"><span>my_plot <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">ggplot</span>(gapminder, <span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> gdpPercap, y <span style="color:#000;font-weight:bold">=</span> lifeExp, colour <span style="color:#000;font-weight:bold">=</span> continent)) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_jitter</span>(position <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">position_jitter</span>(width <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.1</span>, height <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>), alpha <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span><span style="color:#000;font-weight:bold">/</span><span style="color:#099">4</span>) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">labs</span>(title <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Experanza de vida vs. GDP (per cápita)&#34;</span>,
</span></span><span style="display:flex;"><span>       subtitle <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Datos de gapminder. 1952-2007(observaciones cada 5 años)&#34;</span>,
</span></span><span style="display:flex;"><span>       caption <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Source: Gapminder. Jenny Bryan rocks in gapminder vignette!!&#34;</span>, 
</span></span><span style="display:flex;"><span>       x <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;GDP (per cápita)&#34;</span>, y <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Esperanza de Vida (lifeExp)&#34;</span>) 
</span></span></code></pre></div><br>
<img src="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-5-data-munging-manejo-de-datos-con-r-the-tidyverse-way/index_files/figure-html/unnamed-chunk-128-1.png" width="60%" style="display: block; margin: auto;" />
<br>
<hr>




<h1 id="tidylog-package">Tidylog package
  <a href="#tidylog-package"></a>
</h1>
<p>Una herramienta que os puede ser de utilidad para aprender el uso de <code>dplyr</code> es el paquete 
<a href="https://github.com/elbersb/tidylog" target="_blank" rel="noopener"><code>tidylog</code></a>. Este paquete nos da feedback instantáneo sobre qué hacemos cuando usamos las principales funciones de <code>dplyr</code> y <code>tidyr</code>. Veámoslo en acción:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(<span style="color:#d14">&#34;dplyr&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(<span style="color:#d14">&#34;tidyr&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(<span style="color:#d14">&#34;tidylog&#34;</span>, warn.conflicts <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">FALSE</span>)
</span></span><span style="display:flex;"><span>filtered <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">filter</span>(mtcars, cyl <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">4</span>)
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; filter: removed 21 rows (66%), 11 rows remaining</span>
</span></span><span style="display:flex;"><span>mutated <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">mutate</span>(mtcars, new_var <span style="color:#000;font-weight:bold">=</span> wt <span style="color:#000;font-weight:bold">**</span> <span style="color:#099">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#&gt; mutate: new variable &#39;new_var&#39; (double) with 29 unique values and 0% NA</span>
</span></span></code></pre></div><p>Si os fijáis, cada vez que ejecutas una función de <code>dplyr</code> nos devuelve un mensaje explicándonos que se ha hecho. Por ejemplo la linea de código <code>filtered &lt;- filter(mtcars, cyl == 4)</code> ha creado un nuevo data.frame donde se han eliminado 21 filas del df original: <code>#&gt; filter: removed 21 rows (66%), 11 rows remaining</code>.</p>
<p>La segunda linea de código <code>mutated &lt;- mutate(mtcars, new_var = wt ** 2)</code> ha creado una nueva variable con <code>mutate()</code>: <code>#&gt; mutate: new variable 'new_var' with 29 unique values and 0% NA</code>.</p>
<br>
<hr>
<br>




<h1 id="tidyverse-vsbase-r">Tidyverse vs. Base R
  <a href="#tidyverse-vsbase-r"></a>
</h1>
<p>Todo lo que se puede hacer con dplyr, tidyr etc. ,también se puede hacer con Base-R pero de una manera mucho menos intuitiva.</p>
<p>El siguiente ejemplo esta sacado de 
<a href="https://www.r-bloggers.com/when-i-use-plyrdplyr/" target="_blank" rel="noopener">este post</a>. Son dos trozos de código que hacen exactamente lo mismo:</p>
<p>Con el tidyverse:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(dplyr)
</span></span><span style="display:flex;"><span>mtcars <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">group_by</span>(cyl, am) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">select</span>(mpg, cyl, wt, am) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">summarise</span>(avgmpg <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(mpg), avgwt <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(wt)) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">filter</span>(avgmpg <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">20</span>)
</span></span></code></pre></div><p>Con la sintaxis de base R:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">filter</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">summarise</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">select</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#900;font-weight:bold">group_by</span>(mtcars, cyl, am),
</span></span><span style="display:flex;"><span>      mpg, cyl, wt, am),
</span></span><span style="display:flex;"><span>    avgmpg <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(mpg), avgwt <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(wt)),
</span></span><span style="display:flex;"><span>  avgmpg <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">20</span>)
</span></span></code></pre></div><p>O puesto en horizontal</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">filter</span>(<span style="color:#900;font-weight:bold">summarise</span>(<span style="color:#900;font-weight:bold">select</span>(<span style="color:#900;font-weight:bold">group_by</span>(mtcars, cyl, am),  mpg, cyl, wt, am),avgmpg <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(mpg), avgwt <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(wt)), avgmpg <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">20</span>)
</span></span></code></pre></div><br>




<h5 id="otros-2-ejemplos-de-comparación-tidyverse-versus-base-r">Otros 2 ejemplos de comparación tidyverse versus Base-R:
  <a href="#otros-2-ejemplos-de-comparaci%c3%b3n-tidyverse-versus-base-r"></a>
</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>df <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">filter</span>(country <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;Spain&#34;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>  <span style="color:#900;font-weight:bold">select</span>(year, lifeExp)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df[df<span style="color:#000;font-weight:bold">$</span>country <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;Spain&#34;</span>, <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;year&#34;</span>, <span style="color:#d14">&#34;lifeExp&#34;</span>)] 
</span></span></code></pre></div><p>Este último ejemplo lo introduzco porque quiero recordar 
<a href="https://cerebralmastication.github.io/down_with_opp_dplyr.html#/" target="_blank" rel="noopener">estas trasparencias</a> que explican que el paquete <code>dbplyr</code> traduce expresiones de dplyr a SQL. El código de las transparencias está 
<a href="https://github.com/CerebralMastication/Presentations" target="_blank" rel="noopener">aquí</a>, y 
<a href="https://db.rstudio.com/dplyr/" target="_blank" rel="noopener">aquí</a> puedes aprender como hacer queries SQL a un database utilizando la sintaxis de dplyr.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- con tidyverse</span>
</span></span><span style="display:flex;"><span>df_cars <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">select</span>(longname, cyl, hp) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">mutate</span>( shortname <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">word</span>(longname, <span style="color:#099">1</span>) ) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">select</span>( <span style="color:#000;font-weight:bold">-</span> longname)  <span style="color:#000;font-weight:bold">-&gt;</span>
</span></span><span style="display:flex;"><span>df_cars_limited
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">head</span>( df_cars_limited )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#- con dplyr PERO sin %&gt;% </span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">head</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">select</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">mutate</span>( 
</span></span><span style="display:flex;"><span>      <span style="color:#900;font-weight:bold">select</span>(df_cars, longname, cyl, hp) , 
</span></span><span style="display:flex;"><span>      shortname <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">word</span>(longname, <span style="color:#099">1</span>) 
</span></span><span style="display:flex;"><span>      ), 
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">-</span>longname 
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><br>
<br>
<hr>
<br>




<h1 id="bibliografía">Bibliografía
  <a href="#bibliograf%c3%ada"></a>
</h1>
<ul>
<li>
<p>
<a href="http://stat545.com/block009_dplyr-intro.html" target="_blank" rel="noopener">Introducción a dplyr</a>. Jenny Bryan nos cuenta (en sus FANTASTICOS materiales para el curso STAT545) los rudimentos de dplyr. Buena parte de este tutorial se basa en el suyo.</p>
</li>
<li>
<p>
<a href="http://stat545.com/block010_dplyr-end-single-table.html" target="_blank" rel="noopener">dplyr functions for a single dataset</a>. Otro material de Jenny del curso STAT545 sobre dplyr</p>
</li>
<li>
<p>
<a href="https://www.rstudio.com/resources/cheatsheets/" target="_blank" rel="noopener">dplyr CHEAT SHEET</a>. FANTASTIQUÉRRIMA!!! Impresionante!!</p>
</li>
<li>
<p>
<a href="http://r4ds.had.co.nz/transform.html" target="_blank" rel="noopener">Cápitulo de R4DS sobre “dplyr”</a>. De Hadley. Fantástico libro y fantástico capítulo sobre manejo de datos (dplyr).</p>
</li>
<li>
<p>
<a href="http://zevross.com/blog/2015/01/13/a-new-data-processing-workflow-for-r-dplyr-magrittr-tidyr-ggplot2/" target="_blank" rel="noopener">A new data processing workflow for R: dplyr, magrittr, tidyr, ggplot2</a>. Post de un nuevo convencido de las bondades del tidyverse. Un ejemplo sencillo pero ilustrativo.</p>
</li>
<li>
<p>
<a href="https://stanford.edu/~ejdemyr/r-tutorials/wide-and-long/" target="_blank" rel="noopener">Wide &amp; Long Data</a> Post que explica los beneficios de trabajar con datos en formato long (tidy).</p>
</li>
<li>
<p>
<a href="ftp://cran.r-project.org/pub/R/web/packages/tidyr/vignettes/tidy-data.html">La biblia del tidy data</a>. Vignette de tidyr package escrita por Hadley Wickham que explica con MUCHO detalle que son los tidy data.</p>
</li>
<li>
<p>
<a href="https://statisticaloddsandends.wordpress.com/2019/08/30/lesser-known-dplyr-functions/" target="_blank" rel="noopener">Lesser known dplyr functions</a>. Un post fantástico sobre algunas funciones no tan conocidas de <code>dplyr</code>.</p>
</li>
<li>
<p>
<a href="https://dplyr.tidyverse.org/index.html" target="_blank" rel="noopener">Viñetas oficiales de dplyr 1.0.0</a>. Están en la sección “Artículos”. Explican muy bien el funcionamiento de las nuevas funciones de dplyr 1.0.0</p>
</li>
<li>
<p>Durante el proceso de anuncio oficial de dplyr 1.0.0 se publicaron una serie de posts oficiales del tidyverse, concretamente 
<a href="https://www.tidyverse.org/blog/2020/06/dplyr-1-0-0/" target="_blank" rel="noopener">aquí</a>, 
<a href="https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-and-vctrs/" target="_blank" rel="noopener">aquí</a>, 
<a href="https://www.tidyverse.org/blog/2020/03/dplyr-1-0-0-select-rename-relocate/" target="_blank" rel="noopener">aquí</a>, 
<a href="https://www.tidyverse.org/blog/2020/05/dplyr-1-0-0-last-minute-additions/" target="_blank" rel="noopener">aquí</a> y 
<a href="https://www.tidyverse.org/blog/2020/03/dplyr-1-0-0-summarise/" target="_blank" rel="noopener">aquí</a>.Están muy bien.</p>
</li>
<li>
<p>Keith McNulty también me ayudo a entender dplyr 1.00: 
<a href="https://towardsdatascience.com/what-you-need-to-know-about-the-new-dplyr-1-0-0-7eaaaf6d78ac" target="_blank" rel="noopener">aquí</a> y 
<a href="https://towardsdatascience.com/five-tidyverse-tricks-you-may-not-know-about-c5026d5a19da" target="_blank" rel="noopener">aquí</a></p>
</li>
<li>
<p>Rebecca Barter también hizo un 
<a href="http://www.rebeccabarter.com/blog/2020-07-09-across/" target="_blank" rel="noopener">muy buen post</a>.</p>
</li>
<li>
<p>Quizás el tutorial más completo que he visto lo hizo el equipo de ThinkR: 
<a href="https://thinkr.fr/hey-quoi-de-neuf-dplyr-le-point-sur-la-v1/" target="_blank" rel="noopener">aquí</a>. Está en francés.</p>
</li>
</ul>
<hr>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Hasta la aparición de tidyr 1.0.0, las funciones que se usaban eran <code>gather()</code> y <code>spread()</code>. En 
<a href="https://www.youtube.com/watch?v=vYwXMnC03I4&amp;list=LLLm6k7PgDjVcFXJDbWg_OaQ" target="_blank" rel="noopener">esta conferencia</a>, Hadley Wickham nos contó que uno de sus grandes errores durante el desarrollo del tidyverse fue la elección de los nombres de las funciones <code>gather()</code> y <code>spread()</code>. Finalmente podemos decir: bye bye <code>gather()</code> y <code>spread()</code>, wellcome <code>tidyr 1.0.0</code> and <code>pivot_longer()</code> and <code>pivot_wider()</code>.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>La última vez que miré la cheatsheet aún no estaba actualizada para recoger los cambios que aparecieron en dplyr 1.0.0, pero aún así os resultará de mucha utilidad&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>Hasta mayo de 2020, esto es, hasta dplyr 1.0.0, esto se hacia con la función <code>select_if()</code>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>Hasta la aparición de dplyr 1.0.0 en mayo de 2020, se utilizaba la función <code>sumarise_all()</code>&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

      </section>
      <footer class="post-footer">
        <div class="post-pagination dt w-100 mt4 mb2">
  
  
    <a class="prev dtc pr2 tl v-top fw6"
    href="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-4-importar-y-exportar-datos-con-r/">&larr; Tema 4: Importar (y exportar) datos con R</a>
  
  
  
    <a class="next dtc pl2 tr v-top fw6"
    href="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-6-visualizaci-n-gr-ficos-con-ggplot2/">Tema 6: Visualización: gráficos con ggplot2 &rarr;</a>
  
</div>

      </footer>
    </article>
    
  </section>
</main>

<aside class="page-sidebar" role="complementary">
                         
 











  <img src="/collection/featured-sidebar.jpg" class="db ma0">

                         
 



<div class="flex items-start sticky ph4 pb4 flex-row">
  <div class="w-two-thirds w-50-l ph0">
    <h2 class="mv3 f5 fw7 ttu tracked">
      <a class="no-underline dim" href="/collection/">En esta serie</a></h2>
    <nav id="SectionTableOfContents" aria-label="SectionTableOfContents">
        <ul>
        
          
          
          <li class="" hugo-nav="/collection/prework/">
            <a href="https://achalmaedison.netlify.app/collection/prework/">Prework</a></li>
          
          </li>
        
          
          
          
          <details  class="">
            <summary class="" hugo-nav="/collection/day01/"><a href="https://achalmaedison.netlify.app/collection/day01/">Day 01</a></summary>
            
              
              <li class="" hugo-nav="/collection/day01/01-github/"><a href="https://achalmaedison.netlify.app/collection/day01/01-github/">A GitHub profile</a></li>
            
              
              <li class="" hugo-nav="/collection/day01/02-postcards/"><a href="https://achalmaedison.netlify.app/collection/day01/02-postcards/">A postcard</a></li>
            
              
              <li class="" hugo-nav="/collection/day01/03-distill/"><a href="https://achalmaedison.netlify.app/collection/day01/03-distill/">A distill site</a></li>
            
          </details>
          
          </li>
        
          
          
          
          <details  class="">
            <summary class="" hugo-nav="/collection/day02/"><a href="https://achalmaedison.netlify.app/collection/day02/">Day 02</a></summary>
            
              
              <li class="" hugo-nav="/collection/day02/01-netlify/"><a href="https://achalmaedison.netlify.app/collection/day02/01-netlify/">Netlify</a></li>
            
              
              <li class="" hugo-nav="/collection/day02/02-blogdown/"><a href="https://achalmaedison.netlify.app/collection/day02/02-blogdown/">Using blogdown</a></li>
            
              
              <li class="" hugo-nav="/collection/day02/03-blogdown/"><a href="https://achalmaedison.netlify.app/collection/day02/03-blogdown/">Warm woolen mittens</a></li>
            
          </details>
          
          </li>
        
          
          
          
          <details  class="">
            <summary class="" hugo-nav="/collection/2023-01-06-investigacion-operativa/"><a href="https://achalmaedison.netlify.app/collection/2023-01-06-investigacion-operativa/">Investigacion operativa</a></summary>
            
              
              <li class="" hugo-nav="/collection/2023-01-06-investigacion-operativa/2023-01-06-unidad-1/"><a href="https://achalmaedison.netlify.app/collection/2023-01-06-investigacion-operativa/2023-01-06-unidad-1/">Unidad 1</a></li>
            
          </details>
          
          </li>
        
          
          
          
          <details open class="active">
            <summary class="active" hugo-nav="/collection/2023-01-07-ciencia-de-datos/"><a href="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/">Ciencia de datos</a></summary>
            
              
              <li class="" hugo-nav="/collection/2023-01-07-ciencia-de-datos/tema-1-ciencia-de-datos-y-la-era-del-big-data/"><a href="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-1-ciencia-de-datos-y-la-era-del-big-data/">Tema 1: Ciencia de datos y la era del Big Data</a></li>
            
              
              <li class="" hugo-nav="/collection/2023-01-07-ciencia-de-datos/tema-10-eda-y-modelos-datos-de-bebes/"><a href="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-10-eda-y-modelos-datos-de-bebes/">Tema 10: EDA y modelos (datos de bebes)</a></li>
            
              
              <li class="" hugo-nav="/collection/2023-01-07-ciencia-de-datos/tema-2-r-rstudio-y-forma-de-trabajar/"><a href="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-2-r-rstudio-y-forma-de-trabajar/">Tema 2. R, RStudio y forma de trabajar</a></li>
            
              
              <li class="" hugo-nav="/collection/2023-01-07-ciencia-de-datos/tema-3-iniciaci-n-a-r-base/"><a href="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-3-iniciaci-n-a-r-base/">Tema 3: Iniciación a R-base</a></li>
            
              
              <li class="" hugo-nav="/collection/2023-01-07-ciencia-de-datos/tema-4-importar-y-exportar-datos-con-r/"><a href="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-4-importar-y-exportar-datos-con-r/">Tema 4: Importar (y exportar) datos con R</a></li>
            
              
              <li class="active" hugo-nav="/collection/2023-01-07-ciencia-de-datos/tema-5-data-munging-manejo-de-datos-con-r-the-tidyverse-way/"><a href="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-5-data-munging-manejo-de-datos-con-r-the-tidyverse-way/">Tema 5: Data munging: manejo de datos con R, the tidyverse way</a></li>
            
              
              <li class="" hugo-nav="/collection/2023-01-07-ciencia-de-datos/tema-6-visualizaci-n-gr-ficos-con-ggplot2/"><a href="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-6-visualizaci-n-gr-ficos-con-ggplot2/">Tema 6: Visualización: gráficos con ggplot2</a></li>
            
              
              <li class="" hugo-nav="/collection/2023-01-07-ciencia-de-datos/tema-7-documentos-reproducibles-con-rmarkdown/"><a href="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-7-documentos-reproducibles-con-rmarkdown/">Tema 7: Documentos reproducibles con **Rmarkdown**</a></li>
            
              
              <li class="" hugo-nav="/collection/2023-01-07-ciencia-de-datos/tema-8-tablas-en-documentos-rmarkdown/"><a href="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-8-tablas-en-documentos-rmarkdown/">Tema 8: Tablas en documentos Rmarkdown</a></li>
            
              
              <li class="" hugo-nav="/collection/2023-01-07-ciencia-de-datos/tema-9-introduccion-a-gis-con-r/"><a href="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/tema-9-introduccion-a-gis-con-r/">Tema 9: Introduccion a GIS con R</a></li>
            
              
              <li class="" hugo-nav="/collection/2023-01-07-ciencia-de-datos/prefacio/"><a href="https://achalmaedison.netlify.app/collection/2023-01-07-ciencia-de-datos/prefacio/">Prefacio</a></li>
            
          </details>
          
          </li>
        
        </ul>
    </nav>
  </div>
  <details id="PageTableOfContents">
    <summary><h2 class="mv0 f5 fw7 ttu tracked dib">En esta página<h2></summary>
    <div class="pl2 pr0 mh0">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#tidyverse">Tidyverse</a></li>
    <li><a href="#the-pipe-">The pipe (<code>%&gt;%</code>)</a></li>
    <li><a href="#principales-pkgs-del-tidyverse">Principales pkgs del tidyverse</a></li>
  </ul>

  <ul>
    <li></li>
  </ul>

  <ul>
    <li><a href="#dplyr-basics">dplyr basics</a></li>
  </ul>

  <ul>
    <li><a href="#filter"><code>filter()</code></a></li>
    <li><a href="#arrange"><code>arrange()</code></a></li>
    <li><a href="#rename"><code>rename()</code></a></li>
    <li><a href="#select"><code>select()</code></a></li>
    <li><a href="#mutate"><code>mutate()</code></a></li>
    <li><a href="#summarise"><code>summarise()</code></a></li>
    <li><a href="#group_by"><code>group_by()</code></a></li>
    <li><a href="#más-detalles-sobre-dplyr">Más detalles sobre dplyr</a></li>
  </ul>

  <ul>
    <li><a href="#dos-casos-sencillos">(dos) casos sencillos</a></li>
    <li><a href="#mutating-joins">Mutating joins</a></li>
    <li><a href="#filtering-joins">Filtering joins</a></li>
    <li><a href="#set-operations">Set operations</a></li>
  </ul>

  <ul>
    <li></li>
  </ul>
</nav>
    </div>
  </details>
  
</div>

</aside>

<footer class="site-footer pv4 bt b--transparent ph5" role="contentinfo">
  <nav class="db dt-l w-100">
    <p class="site-copyright f7 db dtc-l v-mid w-100 w-33-l tc tl-l pv2 pv0-l mv0 lh-copy">
      &copy; 2023 Edison Achalma, Ayacucho
      <span class="middot-divider"></span>
      Made with <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/hugo-apero/" rel="dct:source">Hugo Apéro</a></span>.
      <br />
      
Based on <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/formspree/blogophonic-hugo" rel="dct:source">Blogophonic</a></span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://formspree.io" property="cc:attributionName" rel="cc:attributionURL">Formspree</a>.
    </p>
    
    <div class="site-social-links db dtc-l v-mid w-100 w-33-l tc pv2 pv0-l mv0">
      <div class="social-icon-links" aria-hidden="true">
  
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://github.com/achalmed" title="github" target="_blank" rel="me noopener">
      <i class="fab fa-github fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.facebook.com/achalmaedison.23" title="facebook-square" target="_blank" rel="me noopener">
      <i class="fab fa-facebook-square fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.instagram.com/achalmaedison/" title="instagram" target="_blank" rel="me noopener">
      <i class="fab fa-instagram fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://twitter.com/achalmaedison" title="twitter" target="_blank" rel="me noopener">
      <i class="fab fa-twitter fa-lg fa-fw"></i>
    </a>
  
    
    
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://orcid.org/0000-0001-6996-3364" title="orcid" target="_blank" rel="me noopener">
      <i class="ai ai-orcid fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.youtube.com/@achalmaedison" title="youtube" target="_blank" rel="me noopener">
      <i class="fab fa-youtube fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.linkedin.com/in/achalmaedison/" title="linkedin-in" target="_blank" rel="me noopener">
      <i class="fab fa-linkedin-in fa-lg fa-fw"></i>
    </a>
  
</div>

    </div>
    
    <div class="site-links f6 db dtc-l v-mid w-100 w-67-l tc tr-l pv2 pv0-l mv0">
      
      <a class="dib pv1 ph2 link" href="/license/" title="License">Licencia</a>
      
      <a class="dib pv1 ph2 link" href="/contact/" title="Contact form">Contacto</a>
      
      <a class="dib pv1 ph2 link" href="/contributors/" title="Contributors">Colaboradores</a>
      
    </div>
  </nav>
  
    <script>

    var i, text, code, codes = document.getElementsByTagName('code');
    for (let i = 0; i < codes.length;) {
      code = codes[i];
      if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
        text = code.textContent;
        if (/^\$[^$]/.test(text) && /[^$]\$$/.test(text)) {
          text = text.replace(/^\$/, '\\(').replace(/\$$/, '\\)');
          code.textContent = text;
        }
        if (/^\\\((.|\s)+\\\)$/.test(text) ||
            /^\\\[(.|\s)+\\\]$/.test(text) ||
            /^\$(.|\s)+\$$/.test(text) ||
            /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
          code.outerHTML = code.innerHTML;  
          continue;
        }
      }
      i++;
    }
</script>

  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>



    
  
  
</footer>

      </div>
    </body>
</html>
